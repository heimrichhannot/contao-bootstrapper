var fs=require("fs");module.exports=function(g){var f="/usr/share/zoneinfo/zone.tab";g.registerTask("zones","Run the unit tests in different timezones.",function(){var a=this.async();e(function(b,d){if(b!=null){throw b}(function c(i){if(i>=d.length){return a()}h(d[i],function(j){if(j!=null){throw j}c(i+1)})}(0))})});function e(a){fs.readFile(f,"ascii",function(b,c){if(b!=null){a(b)}a(null,c.split(/\r\n|\r|\n/).filter(function(d){return d&&!/^#/.test(d)}).map(function(d){return d.split("\t")[2]}))})}function h(b,a){g.log.ok("Running tests in zone "+b);g.util.spawn({cmd:"grunt",opts:{env:{PATH:process.env.PATH,TZ:b}},args:["--no-color","nodeunit"]},function(c,j,d){if(d!==0){g.log.error(j.stdout.split(/\r\n|\r|\n/).filter(function(i){return/^(>>|Warning:|$)/.test(i)}).map(function(i){return(i.substr(0,3)===">> "?i.substr(3):i)}).join("\n"))}a()})}};