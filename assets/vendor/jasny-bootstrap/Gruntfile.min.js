/*
 * Jasny Bootstrap's Gruntfile
 * http://jasny.github.io/bootstrap
 * Copyright 2013-2014 Arnold Daniels.
 * Licensed under Apache License 2.0 (https://github.com/jasny/bootstrap/blob/master/LICENSE)
 */
module.exports=function(g){g.util.linefeed="\n";RegExp.quote=function(h){return h.replace(/[-\\^$*+?.()|[\]{}]/g,"\\$&")};var a=require("fs");var f=require("path");var b=require("./grunt/bs-lessdoc-parser.js");var e=require("./grunt/bs-raw-files-generator.js");var c=require("./grunt/shrinkwrap.js");g.initConfig({pkg:g.file.readJSON("package.json"),banner:'/*!\n * Jasny Bootstrap v<%= pkg.version %> (<%= pkg.homepage %>)\n * Copyright 2012-<%= grunt.template.today("yyyy") %> <%= pkg.author %>\n * Licensed under <%= pkg.license.type %> (<%= pkg.license.url %>)\n */\n',jqueryCheck:"if (typeof jQuery === 'undefined') { throw new Error('Jasny Bootstrap\\'s JavaScript requires jQuery') }\n\n",clean:{dist:["dist","docs/dist"],jekyll:["_gh_pages"],assets:["assets/css/*.min.css","assets/js/*.min.js"],jade:["jade/*.jade"]},jshint:{options:{jshintrc:"js/.jshintrc"},grunt:{options:{jshintrc:"grunt/.jshintrc"},src:["Gruntfile.js","grunt/*.js"]},src:{src:"js/*.js"},test:{src:"js/tests/unit/*.js"},assets:{src:["docs/assets/js/application.js","docs/assets/js/customizer.js"]}},jscs:{options:{config:"js/.jscs.json",},grunt:{src:["Gruntfile.js","grunt/*.js"]},src:{src:"js/*.js"},test:{src:"js/tests/unit/*.js"},assets:{src:["docs/assets/js/application.js","docs/assets/js/customizer.js"]}},csslint:{options:{csslintrc:"less/.csslintrc"},src:["dist/css/<%= pkg.name %>.css","docs/assets/css/docs.css","docs/examples/**/*.css"]},concat:{options:{banner:"<%= banner %>\n<%= jqueryCheck %>",stripBanners:false},bootstrap:{src:["js/transition.js","js/offcanvas.js","js/rowlink.js","js/inputmask.js","js/fileinput.js"],dest:"dist/js/<%= pkg.name %>.js"}},uglify:{options:{report:"min"},bootstrap:{options:{banner:"<%= banner %>"},src:"<%= concat.bootstrap.dest %>",dest:"dist/js/<%= pkg.name %>.min.js"},customize:{options:{preserveComments:"some"},src:["docs/assets/js/vendor/less.min.js","docs/assets/js/vendor/jszip.min.js","docs/assets/js/vendor/uglify.min.js","docs/assets/js/vendor/blob.js","docs/assets/js/vendor/filesaver.js","docs/assets/js/raw-files.min.js","docs/assets/js/customizer.js"],dest:"docs/assets/js/customize.min.js"},docsJs:{options:{preserveComments:"some"},src:["docs/assets/js/vendor/holder.js","docs/assets/js/application.js"],dest:"docs/assets/js/docs.min.js"}},less:{compileCore:{options:{strictMath:true,sourceMap:true,outputSourceFiles:true,sourceMapURL:"<%= pkg.name %>.css.map",sourceMapFilename:"dist/css/<%= pkg.name %>.css.map"},files:{"dist/css/<%= pkg.name %>.css":"less/build/<%= pkg.name %>.less"}},minify:{options:{cleancss:true,report:"min"},files:{"dist/css/<%= pkg.name %>.min.css":"dist/css/<%= pkg.name %>.css"}}},cssmin:{compress:{options:{keepSpecialComments:"*",noAdvanced:true,report:"min",selectorsMergeMode:"ie8"},src:["docs/assets/css/docs.css","docs/assets/css/pygments-manni.css"],dest:"docs/assets/css/docs.min.css"}},usebanner:{dist:{options:{position:"top",banner:"<%= banner %>"},files:{src:["dist/css/<%= pkg.name %>.css","dist/css/<%= pkg.name %>.min.css"]}}},csscomb:{options:{config:"less/.csscomb.json"},dist:{files:{"dist/css/<%= pkg.name %>.css":"dist/css/<%= pkg.name %>.css"}},examples:{expand:true,cwd:"docs/examples/",src:["**/*.css"],dest:"docs/examples/"}},copy:{docs:{expand:true,cwd:"./dist",src:["{css,js}/*.min.*","css/*.map"],dest:"docs/dist"}},qunit:{options:{inject:"js/tests/unit/phantom.js"},files:"js/tests/index.html"},connect:{server:{options:{port:3000,base:"."}}},jekyll:{docs:{}},jade:{compile:{options:{pretty:true,data:function(){var h=f.join(__dirname,"less/build/variables.less");var i=a.readFileSync(h,{encoding:"utf8"});var j=new b(i);return{sections:j.parseFile()}}},files:{"docs/_includes/customizer-variables.html":"docs/jade/customizer-variables.jade","docs/_includes/nav-customize.html":"docs/jade/customizer-nav.jade"}}},validation:{options:{charset:"utf-8",doctype:"HTML5",failHard:true,reset:true,relaxerror:["Bad value X-UA-Compatible for attribute http-equiv on element meta.","Element img is missing required attribute src."]},files:{src:"_gh_pages/**/*.html"}},watch:{src:{files:"<%= jshint.src.src %>",tasks:["jshint:src","qunit"]},test:{files:"<%= jshint.test.src %>",tasks:["jshint:test","qunit"]},less:{files:"less/*.less",tasks:"less"}},replace:{versionNumber:{src:["*.js","*.md","*.json","*.yml","js/*.js"],overwrite:true,replacements:[{from:g.option("oldver"),to:g.option("newver")}]}},"saucelabs-qunit":{all:{options:{build:process.env.TRAVIS_JOB_ID,concurrency:10,urls:["http://127.0.0.1:3000/js/tests/index.html"],browsers:g.file.readYAML("test-infra/sauce_browsers.yml")}}},exec:{npmUpdate:{command:"npm update --silent"},npmShrinkWrap:{command:"npm shrinkwrap --dev"}}});require("load-grunt-tasks")(g,{scope:"devDependencies"});g.registerTask("validate-html",["jekyll","validation"]);var d=[];if(!process.env.TWBS_TEST||process.env.TWBS_TEST==="core"){d=d.concat(["dist-css","csslint","jshint","jscs","qunit","build-customizer-html"])}if(!process.env.TWBS_TEST||process.env.TWBS_TEST==="validate-html"){d.push("validate-html")}if(typeof process.env.SAUCE_ACCESS_KEY!=="undefined"&&(!process.env.TWBS_TEST||process.env.TWBS_TEST==="sauce-js-unit")){d.push("connect");d.push("saucelabs-qunit")}g.registerTask("test",d);g.registerTask("dist-js",["concat","uglify"]);g.registerTask("dist-css",["less","cssmin","csscomb","usebanner"]);g.registerTask("dist-docs","copy:docs");g.registerTask("dist",["clean:dist","dist-css","dist-js","dist-docs"]);g.registerTask("default",["dist","build-customizer"]);g.registerTask("docs",["jekyll","dist-docs"]);g.registerTask("change-version-number","replace");g.registerTask("build-customizer",["build-customizer-html","build-raw-files"]);g.registerTask("build-customizer-html","jade");g.registerTask("build-raw-files","Add scripts/less files to customizer.",function(){var h=g.template.process("<%= banner %>");e(h)});g.registerTask("update-shrinkwrap",["exec:npmUpdate","exec:npmShrinkWrap","∆update-shrinkwrap"]);g.registerTask("∆update-shrinkwrap",function(){c.call(this,g)})};