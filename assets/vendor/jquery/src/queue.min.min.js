define(["./core","./data/var/data_priv","./deferred","./callbacks"],function(c,d){c.extend({queue:function(b,g,a){var h;if(b){g=(g||"fx")+"queue";h=d.get(b,g);if(a){if(!h||c.isArray(a)){h=d.access(b,g,c.makeArray(a))}else{h.push(a)}}return h||[]}},dequeue:function(b,j){j=j||"fx";var m=c.queue(b,j),a=m.length,k=m.shift(),n=c._queueHooks(b,j),l=function(){c.dequeue(b,j)};if(k==="inprogress"){k=m.shift();a--}if(k){if(j==="fx"){m.unshift("inprogress")}delete n.stop;k.call(b,l,n)}if(!a&&n){n.empty.fire()}},_queueHooks:function(a,b){var f=b+"queueHooks";return d.get(a,f)||d.access(a,f,{empty:c.Callbacks("once memory").add(function(){d.remove(a,[b+"queue",f])})})}});c.fn.extend({queue:function(f,b){var a=2;if(typeof f!=="string"){b=f;f="fx";a--}if(arguments.length<a){return c.queue(this[0],f)}return b===undefined?this:this.each(function(){var e=c.queue(this,f,b);c._queueHooks(this,f);if(f==="fx"&&e[0]!=="inprogress"){c.dequeue(this,f)}})},dequeue:function(a){return this.each(function(){c.dequeue(this,a)})},clearQueue:function(a){return this.queue(a||"fx",[])},promise:function(n,b){var o,m=1,a=c.Deferred(),i=this,p=this.length,l=function(){if(!(--m)){a.resolveWith(i,[i])}};if(typeof n!=="string"){b=n;n=undefined}n=n||"fx";while(p--){o=d.get(i[p],n+"queueHooks");if(o&&o.empty){m++;o.empty.add(l)}}l();return a.promise(b)}});return c});