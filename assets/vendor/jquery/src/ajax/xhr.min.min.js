define(["../core","../var/support","../ajax"],function(j,l){j.ajaxSettings.xhr=function(){try{return new XMLHttpRequest()}catch(a){}};var k=0,g={},h={0:200,1223:204},i=j.ajaxSettings.xhr();if(window.attachEvent){window.attachEvent("onunload",function(){for(var a in g){g[a]()}})}l.cors=!!i&&("withCredentials" in i);l.ajax=i=!!i;j.ajaxTransport(function(b){var a;if(l.cors||i&&!b.crossDomain){return{send:function(q,f){var e,c=b.xhr(),p=++k;c.open(b.type,b.url,b.async,b.username,b.password);if(b.xhrFields){for(e in b.xhrFields){c[e]=b.xhrFields[e]}}if(b.mimeType&&c.overrideMimeType){c.overrideMimeType(b.mimeType)}if(!b.crossDomain&&!q["X-Requested-With"]){q["X-Requested-With"]="XMLHttpRequest"}for(e in q){c.setRequestHeader(e,q[e])}a=function(m){return function(){if(a){delete g[p];a=c.onload=c.onerror=null;if(m==="abort"){c.abort()}else{if(m==="error"){f(c.status,c.statusText)}else{f(h[c.status]||c.status,c.statusText,typeof c.responseText==="string"?{text:c.responseText}:undefined,c.getAllResponseHeaders())}}}}};c.onload=a();c.onerror=a("error");a=g[p]=a("abort");try{c.send(b.hasContent&&b.data||null)}catch(d){if(a){throw d}}},abort:function(){if(a){a()}}}}})});