"use strict";var Markdown=require("markdown-it");function markdown2html(c){var d=new Markdown();return d.render(c.trim()).slice(3,-5)}var CUSTOMIZABLE_HEADING=/^[/]{2}={2}(.*)$/;var UNCUSTOMIZABLE_HEADING=/^[/]{2}-{2}(.*)$/;var SUBSECTION_HEADING=/^[/]{2}={3}(.*)$/;var SECTION_DOCSTRING=/^[/]{2}#{2}(.+)$/;var VAR_ASSIGNMENT=/^(@[a-zA-Z0-9_-]+):[ ]*([^ ;][^;]*);[ ]*$/;var VAR_DOCSTRING=/^[/]{2}[*]{2}(.+)$/;function Section(c,d){this.heading=c.trim();this.id=this.heading.replace(/\s+/g,"-").toLowerCase();this.customizable=d;this.docstring=null;this.subsections=[]}Section.prototype.addSubSection=function(b){this.subsections.push(b)};function SubSection(b){this.heading=b.trim();this.id=this.heading.replace(/\s+/g,"-").toLowerCase();this.variables=[]}SubSection.prototype.addVar=function(b){this.variables.push(b)};function VarDocstring(b){this.html=markdown2html(b)}function SectionDocstring(b){this.html=markdown2html(b)}function Variable(c,d){this.name=c;this.defaultValue=d;this.docstring=null}function Tokenizer(b){this._lines=b.split("\n");this._next=undefined}Tokenizer.prototype.unshift=function(b){if(this._next!==undefined){throw new Error("Attempted to unshift twice!")}this._next=b};Tokenizer.prototype._shift=function(){if(this._next!==undefined){var g=this._next;this._next=undefined;return g}if(this._lines.length<=0){return null}var f=this._lines.shift();var j=null;j=SUBSECTION_HEADING.exec(f);if(j!==null){return new SubSection(j[1])}j=CUSTOMIZABLE_HEADING.exec(f);if(j!==null){return new Section(j[1],true)}j=UNCUSTOMIZABLE_HEADING.exec(f);if(j!==null){return new Section(j[1],false)}j=SECTION_DOCSTRING.exec(f);if(j!==null){return new SectionDocstring(j[1])}j=VAR_DOCSTRING.exec(f);if(j!==null){return new VarDocstring(j[1])}var h=f.lastIndexOf("//");var i=h===-1?f:f.slice(0,h);j=VAR_ASSIGNMENT.exec(i);if(j!==null){return new Variable(j[1],j[2])}return undefined};Tokenizer.prototype.shift=function(){while(true){var b=this._shift();if(b===undefined){continue}return b}};function Parser(b){this._tokenizer=new Tokenizer(b)}Parser.prototype.parseFile=function(){var c=[];while(true){var d=this.parseSection();if(d===null){if(this._tokenizer.shift()!==null){throw new Error("Unexpected unparsed section of file remains!")}return c}c.push(d)}};Parser.prototype.parseSection=function(){var c=this._tokenizer.shift();if(c===null){return null}if(!(c instanceof Section)){throw new Error("Expected section heading; got: "+JSON.stringify(c))}var d=this._tokenizer.shift();if(d instanceof SectionDocstring){c.docstring=d}else{this._tokenizer.unshift(d)}this.parseSubSections(c);return c};Parser.prototype.parseSubSections=function(c){while(true){var d=this.parseSubSection();if(d===null){if(c.subsections.length===0){d=new SubSection("");this.parseVars(d)}else{break}}c.addSubSection(d)}if(c.subsections.length===1&&!c.subsections[0].heading&&c.subsections[0].variables.length===0){c.subsections=[]}};Parser.prototype.parseSubSection=function(){var b=this._tokenizer.shift();if(b instanceof SubSection){this.parseVars(b);return b}this._tokenizer.unshift(b);return null};Parser.prototype.parseVars=function(c){while(true){var d=this.parseVar();if(d===null){return}c.addVar(d)}};Parser.prototype.parseVar=function(){var c=this._tokenizer.shift();if(!(c instanceof VarDocstring)){this._tokenizer.unshift(c);c=null}var d=this._tokenizer.shift();if(d instanceof Variable){d.docstring=c;return d}this._tokenizer.unshift(d);return null};module.exports=Parser;