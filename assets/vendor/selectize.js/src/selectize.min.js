var Selectize=function(f,c){var h,d,a,b,g,j=this;g=f[0];g.selectize=j;var e=window.getComputedStyle&&window.getComputedStyle(g,null);b=e?e.getPropertyValue("direction"):g.currentStyle&&g.currentStyle.direction;b=b||f.parents("[dir]:first").attr("dir")||"";$.extend(j,{settings:c,$input:f,tagType:g.tagName.toLowerCase()==="select"?TAG_SELECT:TAG_INPUT,rtl:/rtl/i.test(b),eventNS:".selectize"+(++Selectize.count),highlightedValue:null,isOpen:false,isDisabled:false,isRequired:f.is("[required]"),isInvalid:false,isLocked:false,isFocused:false,isInputHidden:false,isSetup:false,isShiftDown:false,isCmdDown:false,isCtrlDown:false,ignoreFocus:false,ignoreBlur:false,ignoreHover:false,hasOptions:false,currentResults:null,lastValue:"",caretPos:0,loading:0,loadedSearches:{},$activeOption:null,$activeItems:[],optgroups:{},options:{},userOptions:{},items:[],renderCache:{},onSearchChange:c.loadThrottle===null?j.onSearchChange:debounce(j.onSearchChange,c.loadThrottle)});j.sifter=new Sifter(this.options,{diacritics:c.diacritics});$.extend(j.options,build_hash_table(c.valueField,c.options));delete j.settings.options;$.extend(j.optgroups,build_hash_table(c.optgroupValueField,c.optgroups));delete j.settings.optgroups;j.settings.mode=j.settings.mode||(j.settings.maxItems===1?"single":"multi");if(typeof j.settings.hideSelected!=="boolean"){j.settings.hideSelected=j.settings.mode==="multi"}j.initializePlugins(j.settings.plugins);j.setupCallbacks();j.setupTemplates();j.setup()};MicroEvent.mixin(Selectize);MicroPlugin.mixin(Selectize);$.extend(Selectize.prototype,{setup:function(){var f=this;var m=f.settings;var i=f.eventNS;var e=$(window);var q=$(document);var b=f.$input;var j;var o;var a;var c;var g;var k;var r;var d;var p;var l;var n;var h;r=f.settings.mode;l=b.attr("tabindex")||"";n=b.attr("class")||"";j=$("<div>").addClass(m.wrapperClass).addClass(n).addClass(r);o=$("<div>").addClass(m.inputClass).addClass("items").appendTo(j);a=$('<input type="text" autocomplete="off" />').appendTo(o).attr("tabindex",l);k=$(m.dropdownParent||j);c=$("<div>").addClass(m.dropdownClass).addClass(r).hide().appendTo(k);g=$("<div>").addClass(m.dropdownContentClass).appendTo(c);if(f.settings.copyClassesToDropdown){c.addClass(n)}j.css({width:b[0].style.width});if(f.plugins.names.length){h="plugin-"+f.plugins.names.join(" plugin-");j.addClass(h);c.addClass(h)}if((m.maxItems===null||m.maxItems>1)&&f.tagType===TAG_SELECT){b.attr("multiple","multiple")}if(f.settings.placeholder){a.attr("placeholder",m.placeholder)}if(b.attr("autocorrect")){a.attr("autocorrect",b.attr("autocorrect"))}if(b.attr("autocapitalize")){a.attr("autocapitalize",b.attr("autocapitalize"))}f.$wrapper=j;f.$control=o;f.$control_input=a;f.$dropdown=c;f.$dropdown_content=g;c.on("mouseenter","[data-selectable]",function(){return f.onOptionHover.apply(f,arguments)});c.on("mousedown","[data-selectable]",function(){return f.onOptionSelect.apply(f,arguments)});watchChildEvent(o,"mousedown","*:not(input)",function(){return f.onItemSelect.apply(f,arguments)});autoGrow(a);o.on({mousedown:function(){return f.onMouseDown.apply(f,arguments)},click:function(){return f.onClick.apply(f,arguments)}});a.on({mousedown:function(s){s.stopPropagation()},keydown:function(){return f.onKeyDown.apply(f,arguments)},keyup:function(){return f.onKeyUp.apply(f,arguments)},keypress:function(){return f.onKeyPress.apply(f,arguments)},resize:function(){f.positionDropdown.apply(f,[])},blur:function(){return f.onBlur.apply(f,arguments)},focus:function(){f.ignoreBlur=false;return f.onFocus.apply(f,arguments)},paste:function(){return f.onPaste.apply(f,arguments)}});q.on("keydown"+i,function(s){f.isCmdDown=s[IS_MAC?"metaKey":"ctrlKey"];f.isCtrlDown=s[IS_MAC?"altKey":"ctrlKey"];f.isShiftDown=s.shiftKey});q.on("keyup"+i,function(s){if(s.keyCode===KEY_CTRL){f.isCtrlDown=false}if(s.keyCode===KEY_SHIFT){f.isShiftDown=false}if(s.keyCode===KEY_CMD){f.isCmdDown=false}});q.on("mousedown"+i,function(s){if(f.isFocused){if(s.target===f.$dropdown[0]||s.target.parentNode===f.$dropdown[0]){return false}if(!f.$control.has(s.target).length&&s.target!==f.$control[0]){f.blur()}}});e.on(["scroll"+i,"resize"+i].join(" "),function(){if(f.isOpen){f.positionDropdown.apply(f,arguments)}});e.on("mousemove"+i,function(){f.ignoreHover=false});this.revertSettings={$children:b.children().detach(),tabindex:b.attr("tabindex")};b.attr("tabindex",-1).hide().after(f.$wrapper);if($.isArray(m.items)){f.setValue(m.items);delete m.items}if(b[0].validity){b.on("invalid"+i,function(s){s.preventDefault();f.isInvalid=true;f.refreshState()})}f.updateOriginalInput();f.refreshItems();f.refreshState();f.updatePlaceholder();f.isSetup=true;if(b.is(":disabled")){f.disable()}f.on("change",this.onChange);b.data("selectize",f);b.addClass("selectized");f.trigger("initialize");if(m.preload===true){f.onSearchChange("")}},setupTemplates:function(){var b=this;var a=b.settings.labelField;var c=b.settings.optgroupLabelField;var d={optgroup:function(e){return'<div class="optgroup">'+e.html+"</div>"},optgroup_header:function(f,e){return'<div class="optgroup-header">'+e(f[c])+"</div>"},option:function(f,e){return'<div class="option">'+e(f[a])+"</div>"},item:function(f,e){return'<div class="item">'+e(f[a])+"</div>"},option_create:function(f,e){return'<div class="create">Add <strong>'+e(f.input)+"</strong>&hellip;</div>"}};b.settings.render=$.extend({},d,b.settings.render)},setupCallbacks:function(){var a,b,c={initialize:"onInitialize",change:"onChange",item_add:"onItemAdd",item_remove:"onItemRemove",clear:"onClear",option_add:"onOptionAdd",option_remove:"onOptionRemove",option_clear:"onOptionClear",dropdown_open:"onDropdownOpen",dropdown_close:"onDropdownClose",type:"onType",load:"onLoad"};for(a in c){if(c.hasOwnProperty(a)){b=this.settings[c[a]];if(b){this.on(a,b)}}}},onClick:function(b){var a=this;if(!a.isFocused){a.focus();b.preventDefault()}},onMouseDown:function(d){var b=this;var c=d.isDefaultPrevented();var a=$(d.target);if(b.isFocused){if(d.target!==b.$control_input[0]){if(b.settings.mode==="single"){b.isOpen?b.close():b.open()}else{if(!c){b.setActiveItem(null)}}return false}}else{if(!c){window.setTimeout(function(){b.focus()},0)}}},onChange:function(){this.$input.trigger("change")},onPaste:function(b){var a=this;if(a.isFull()||a.isInputHidden||a.isLocked){b.preventDefault()}},onKeyPress:function(b){if(this.isLocked){return b&&b.preventDefault()}var a=String.fromCharCode(b.keyCode||b.which);if(this.settings.create&&a===this.settings.delimiter){this.createItem();b.preventDefault();return false}},onKeyDown:function(f){var d=f.target===this.$control_input[0];var c=this;if(c.isLocked){if(f.keyCode!==KEY_TAB){f.preventDefault()}return}switch(f.keyCode){case KEY_A:if(c.isCmdDown){c.selectAll();return}break;case KEY_ESC:c.close();return;case KEY_N:if(!f.ctrlKey||f.altKey){break}case KEY_DOWN:if(!c.isOpen&&c.hasOptions){c.open()}else{if(c.$activeOption){c.ignoreHover=true;var a=c.getAdjacentOption(c.$activeOption,1);if(a.length){c.setActiveOption(a,true,true)}}}f.preventDefault();return;case KEY_P:if(!f.ctrlKey||f.altKey){break}case KEY_UP:if(c.$activeOption){c.ignoreHover=true;var b=c.getAdjacentOption(c.$activeOption,-1);if(b.length){c.setActiveOption(b,true,true)}}f.preventDefault();return;case KEY_RETURN:if(c.isOpen&&c.$activeOption){c.onOptionSelect({currentTarget:c.$activeOption})}f.preventDefault();return;case KEY_LEFT:c.advanceSelection(-1,f);return;case KEY_RIGHT:c.advanceSelection(1,f);return;case KEY_TAB:if(c.settings.selectOnTab&&c.isOpen&&c.$activeOption){c.onOptionSelect({currentTarget:c.$activeOption});f.preventDefault()}if(c.settings.create&&c.createItem()){f.preventDefault()}return;case KEY_BACKSPACE:case KEY_DELETE:c.deleteSelection(f);return}if((c.isFull()||c.isInputHidden)&&!(IS_MAC?f.metaKey:f.ctrlKey)){f.preventDefault();return}},onKeyUp:function(c){var a=this;if(a.isLocked){return c&&c.preventDefault()}var b=a.$control_input.val()||"";if(a.lastValue!==b){a.lastValue=b;a.onSearchChange(b);a.refreshOptions();a.trigger("type",b)}},onSearchChange:function(c){var a=this;var b=a.settings.load;if(!b){return}if(a.loadedSearches.hasOwnProperty(c)){return}a.loadedSearches[c]=true;a.load(function(d){b.apply(a,[c,d])})},onFocus:function(b){var a=this;a.isFocused=true;if(a.isDisabled){a.blur();b&&b.preventDefault();return false}if(a.ignoreFocus){return}if(a.settings.preload==="focus"){a.onSearchChange("")}if(!a.$activeItems.length){a.showInput();a.setActiveItem(null);a.refreshOptions(!!a.settings.openOnFocus)}a.refreshState()},onBlur:function(b){var a=this;a.isFocused=false;if(a.ignoreFocus){return}if(!a.ignoreBlur&&document.activeElement===a.$dropdown_content[0]){a.ignoreBlur=true;a.onFocus(b);return}if(a.settings.create&&a.settings.createOnBlur){a.createItem(false)}a.close();a.setTextboxValue("");a.setActiveItem(null);a.setActiveOption(null);a.setCaret(a.items.length);a.refreshState()},onOptionHover:function(a){if(this.ignoreHover){return}this.setActiveOption(a.currentTarget,false)},onOptionSelect:function(f){var c,a,d,b=this;if(f.preventDefault){f.preventDefault();f.stopPropagation()}a=$(f.currentTarget);if(a.hasClass("create")){b.createItem()}else{c=a.attr("data-value");if(typeof c!=="undefined"){b.lastQuery=null;b.setTextboxValue("");b.addItem(c);if(!b.settings.hideSelected&&f.type&&/mouse/.test(f.type)){b.setActiveOption(b.getOption(c))}}}},onItemSelect:function(b){var a=this;if(a.isLocked){return}if(a.settings.mode==="multi"){b.preventDefault();a.setActiveItem(b.currentTarget,b)}},load:function(b){var a=this;var c=a.$wrapper.addClass("loading");a.loading++;b.apply(a,[function(d){a.loading=Math.max(a.loading-1,0);if(d&&d.length){a.addOption(d);a.refreshOptions(a.isFocused&&!a.isInputHidden)}if(!a.loading){c.removeClass("loading")}a.trigger("load",d)}])},setTextboxValue:function(a){var c=this.$control_input;var b=c.val()!==a;if(b){c.val(a).triggerHandler("update");this.lastValue=a}},getValue:function(){if(this.tagType===TAG_SELECT&&this.$input.attr("multiple")){return this.items}else{return this.items.join(this.settings.delimiter)}},setValue:function(a){debounce_events(this,["change"],function(){this.clear();this.addItems(a)})},setActiveItem:function(j,g){var m=this;var f;var d,k,a,c,l,b;var h;if(m.settings.mode==="single"){return}j=$(j);if(!j.length){$(m.$activeItems).removeClass("active");m.$activeItems=[];if(m.isFocused){m.showInput()}return}f=g&&g.type.toLowerCase();if(f==="mousedown"&&m.isShiftDown&&m.$activeItems.length){h=m.$control.children(".active:last");a=Array.prototype.indexOf.apply(m.$control[0].childNodes,[h[0]]);c=Array.prototype.indexOf.apply(m.$control[0].childNodes,[j[0]]);if(a>c){b=a;a=c;c=b}for(d=a;d<=c;d++){l=m.$control[0].childNodes[d];if(m.$activeItems.indexOf(l)===-1){$(l).addClass("active");m.$activeItems.push(l)}}g.preventDefault()}else{if((f==="mousedown"&&m.isCtrlDown)||(f==="keydown"&&this.isShiftDown)){if(j.hasClass("active")){k=m.$activeItems.indexOf(j[0]);m.$activeItems.splice(k,1);j.removeClass("active")}else{m.$activeItems.push(j.addClass("active")[0])}}else{$(m.$activeItems).removeClass("active");m.$activeItems=[j.addClass("active")[0]]}}m.hideInput();if(!this.isFocused){m.focus()}},setActiveOption:function(a,g,c){var b,h,f;var e,d;var i=this;if(i.$activeOption){i.$activeOption.removeClass("active")}i.$activeOption=null;a=$(a);if(!a.length){return}i.$activeOption=a.addClass("active");if(g||!isset(g)){b=i.$dropdown_content.height();h=i.$activeOption.outerHeight(true);g=i.$dropdown_content.scrollTop()||0;f=i.$activeOption.offset().top-i.$dropdown_content.offset().top+g;e=f;d=f-b+h;if(f+h>b+g){i.$dropdown_content.stop().animate({scrollTop:d},c?i.settings.scrollDuration:0)}else{if(f<g){i.$dropdown_content.stop().animate({scrollTop:e},c?i.settings.scrollDuration:0)}}}},selectAll:function(){var a=this;if(a.settings.mode==="single"){return}a.$activeItems=Array.prototype.slice.apply(a.$control.children(":not(input)").addClass("active"));if(a.$activeItems.length){a.hideInput();a.close()}a.focus()},hideInput:function(){var a=this;a.setTextboxValue("");a.$control_input.css({opacity:0,position:"absolute",left:a.rtl?10000:-10000});a.isInputHidden=true},showInput:function(){this.$control_input.css({opacity:1,position:"relative",left:0});this.isInputHidden=false},focus:function(){var a=this;if(a.isDisabled){return}a.ignoreFocus=true;a.$control_input[0].focus();window.setTimeout(function(){a.ignoreFocus=false;a.onFocus()},0)},blur:function(){this.$control_input.trigger("blur")},getScoreFunction:function(a){return this.sifter.getScoreFunction(a,this.getSearchOptions())},getSearchOptions:function(){var b=this.settings;var a=b.sortField;if(typeof a==="string"){a={field:a}}return{fields:b.searchField,conjunction:b.searchConjunction,sort:a}},search:function(e){var d,f,a,j,c;var g=this;var b=g.settings;var h=this.getSearchOptions();if(b.score){c=g.settings.score.apply(this,[e]);if(typeof c!=="function"){throw new Error('Selectize "score" setting must be a function that returns a function')}}if(e!==g.lastQuery){g.lastQuery=e;j=g.sifter.search(e,$.extend(h,{score:c}));g.currentResults=j}else{j=$.extend(true,{},g.currentResults)}if(b.hideSelected){for(d=j.items.length-1;d>=0;d--){if(g.items.indexOf(hash_key(j.items[d].id))!==-1){j.items.splice(d,1)}}}return j},refreshOptions:function(o){var v,u,t,r,y,a,g,w,c,s,e,x,f;var d,m,p;if(typeof o==="undefined"){o=true}var l=this;var b=$.trim(l.$control_input.val());var q=l.search(b);var h=l.$dropdown_content;var z=l.$activeOption&&hash_key(l.$activeOption.attr("data-value"));r=q.items.length;if(typeof l.settings.maxOptions==="number"){r=Math.min(r,l.settings.maxOptions)}y={};if(l.settings.optgroupOrder){a=l.settings.optgroupOrder;for(v=0;v<a.length;v++){y[a[v]]=[]}}else{a=[]}for(v=0;v<r;v++){g=l.options[q.items[v].id];w=l.render("option",g);c=g[l.settings.optgroupField]||"";s=$.isArray(c)?c:[c];for(u=0,t=s&&s.length;u<t;u++){c=s[u];if(!l.optgroups.hasOwnProperty(c)){c=""}if(!y.hasOwnProperty(c)){y[c]=[];a.push(c)}y[c].push(w)}}e=[];for(v=0,r=a.length;v<r;v++){c=a[v];if(l.optgroups.hasOwnProperty(c)&&y[c].length){x=l.render("optgroup_header",l.optgroups[c])||"";x+=y[c].join("");e.push(l.render("optgroup",$.extend({},l.optgroups[c],{html:x})))}else{e.push(y[c].join(""))}}h.html(e.join(""));if(l.settings.highlight&&q.query.length&&q.tokens.length){for(v=0,r=q.tokens.length;v<r;v++){highlight(h,q.tokens[v].regex)}}if(!l.settings.hideSelected){for(v=0,r=l.items.length;v<r;v++){l.getOption(l.items[v]).addClass("selected")}}f=l.canCreate(b);if(f){h.prepend(l.render("option_create",{input:b}));p=$(h[0].childNodes[0])}l.hasOptions=q.items.length>0||f;if(l.hasOptions){if(q.items.length>0){m=z&&l.getOption(z);if(m&&m.length){d=m}else{if(l.settings.mode==="single"&&l.items.length){d=l.getOption(l.items[0])}}if(!d||!d.length){if(p&&!l.settings.addPrecedence){d=l.getAdjacentOption(p,1)}else{d=h.find("[data-selectable]:first")}}}else{d=p}l.setActiveOption(d);if(o&&!l.isOpen){l.open()}}else{l.setActiveOption(null);if(o&&l.isOpen){l.close()}}},addOption:function(e){var c,f,b,d,a=this;if($.isArray(e)){for(c=0,f=e.length;c<f;c++){a.addOption(e[c])}return}d=hash_key(e[a.settings.valueField]);if(typeof d!=="string"||a.options.hasOwnProperty(d)){return}a.userOptions[d]=true;a.options[d]=e;a.lastQuery=null;a.trigger("option_add",d,e)},addOptionGroup:function(b,a){this.optgroups[b]=a;this.trigger("optgroup_add",b,a)},updateOption:function(g,e){var i=this;var h,a;var c,d,f,b;g=hash_key(g);c=hash_key(e[i.settings.valueField]);if(g===null){return}if(!i.options.hasOwnProperty(g)){return}if(typeof c!=="string"){throw new Error("Value must be set in option data")}if(c!==g){delete i.options[g];d=i.items.indexOf(g);if(d!==-1){i.items.splice(d,1,c)}}i.options[c]=e;f=i.renderCache.item;b=i.renderCache.option;if(f){delete f[g];delete f[c]}if(b){delete b[g];delete b[c]}if(i.items.indexOf(c)!==-1){h=i.getItem(g);a=$(i.render("item",e));if(h.hasClass("active")){a.addClass("active")}h.replaceWith(a)}i.lastQuery=null;if(i.isOpen){i.refreshOptions(false)}},removeOption:function(d){var b=this;d=hash_key(d);var a=b.renderCache.item;var c=b.renderCache.option;if(a){delete a[d]}if(c){delete c[d]}delete b.userOptions[d];delete b.options[d];b.lastQuery=null;b.trigger("option_remove",d);b.removeItem(d)},clearOptions:function(){var a=this;a.loadedSearches={};a.userOptions={};a.renderCache={};a.options=a.sifter.items={};a.lastQuery=null;a.trigger("option_clear");a.clear()},getOption:function(a){return this.getElementWithValue(a,this.$dropdown_content.find("[data-selectable]"))},getAdjacentOption:function(d,c){var a=this.$dropdown.find("[data-selectable]");var b=a.index(d)+c;return b>=0&&b<a.length?a.eq(b):$()},getElementWithValue:function(c,b){c=hash_key(c);if(typeof c!=="undefined"&&c!==null){for(var a=0,d=b.length;a<d;a++){if(b[a].getAttribute("data-value")===c){return $(b[a])}}}return $()},getItem:function(a){return this.getElementWithValue(a,this.$control.children())},addItems:function(b){var a=$.isArray(b)?b:[b];for(var c=0,d=a.length;c<d;c++){this.isPending=(c<d-1);this.addItem(a[c])}},addItem:function(a){debounce_events(this,["change"],function(){var j,c,g;var k=this;var b=k.settings.mode;var f,e,h,d;a=hash_key(a);if(k.items.indexOf(a)!==-1){if(b==="single"){k.close()}return}if(!k.options.hasOwnProperty(a)){return}if(b==="single"){k.clear()}if(b==="multi"&&k.isFull()){return}j=$(k.render("item",k.options[a]));d=k.isFull();k.items.splice(k.caretPos,0,a);k.insertAtCaret(j);if(!k.isPending||(!d&&k.isFull())){k.refreshState()}if(k.isSetup){g=k.$dropdown_content.find("[data-selectable]");if(!k.isPending){c=k.getOption(a);h=k.getAdjacentOption(c,1).attr("data-value");k.refreshOptions(k.isFocused&&b!=="single");if(h){k.setActiveOption(k.getOption(h))}}if(!g.length||k.isFull()){k.close()}else{k.positionDropdown()}k.updatePlaceholder();k.trigger("item_add",a,j);k.updateOriginalInput()}})},removeItem:function(e){var c=this;var b,d,a;b=(typeof e==="object")?e:c.getItem(e);e=hash_key(b.attr("data-value"));d=c.items.indexOf(e);if(d!==-1){b.remove();if(b.hasClass("active")){a=c.$activeItems.indexOf(b[0]);c.$activeItems.splice(a,1)}c.items.splice(d,1);c.lastQuery=null;if(!c.settings.persist&&c.userOptions.hasOwnProperty(e)){c.removeOption(e)}if(d<c.caretPos){c.setCaret(c.caretPos-1)}c.refreshState();c.updatePlaceholder();c.updateOriginalInput();c.positionDropdown();c.trigger("item_remove",e)}},createItem:function(f){var d=this;var c=$.trim(d.$control_input.val()||"");var g=d.caretPos;if(!d.canCreate(c)){return false}d.lock();if(typeof f==="undefined"){f=true}var a=(typeof d.settings.create==="function")?this.settings.create:function(h){var i={};i[d.settings.labelField]=h;i[d.settings.valueField]=h;return i};var e=once(function(i){d.unlock();if(!i||typeof i!=="object"){return}var h=hash_key(i[d.settings.valueField]);if(typeof h!=="string"){return}d.setTextboxValue("");d.addOption(i);d.setCaret(g);d.addItem(h);d.refreshOptions(f&&d.settings.mode!=="single")});var b=a.apply(this,[c,e]);if(typeof b!=="undefined"){e(b)}return true},refreshItems:function(){this.lastQuery=null;if(this.isSetup){for(var a=0;a<this.items.length;a++){this.addItem(this.items)}}this.refreshState();this.updateOriginalInput()},refreshState:function(){var b,a=this;if(a.isRequired){if(a.items.length){a.isInvalid=false}a.$control_input.prop("required",b)}a.refreshClasses()},refreshClasses:function(){var a=this;var b=a.isFull();var c=a.isLocked;a.$wrapper.toggleClass("rtl",a.rtl);a.$control.toggleClass("focus",a.isFocused).toggleClass("disabled",a.isDisabled).toggleClass("required",a.isRequired).toggleClass("invalid",a.isInvalid).toggleClass("locked",c).toggleClass("full",b).toggleClass("not-full",!b).toggleClass("input-active",a.isFocused&&!a.isInputHidden).toggleClass("dropdown-active",a.isOpen).toggleClass("has-options",!$.isEmptyObject(a.options)).toggleClass("has-items",a.items.length>0);a.$control_input.data("grow",!b&&!c)},isFull:function(){return this.settings.maxItems!==null&&this.items.length>=this.settings.maxItems},updateOriginalInput:function(){var c,d,b,a=this;if(a.tagType===TAG_SELECT){b=[];for(c=0,d=a.items.length;c<d;c++){b.push('<option value="'+escape_html(a.items[c])+'" selected="selected"></option>')}if(!b.length&&!this.$input.attr("multiple")){b.push('<option value="" selected="selected"></option>')}a.$input.html(b.join(""))}else{a.$input.val(a.getValue());a.$input.attr("value",a.$input.val())}if(a.isSetup){a.trigger("change",a.$input.val())}},updatePlaceholder:function(){if(!this.settings.placeholder){return}var a=this.$control_input;if(this.items.length){a.removeAttr("placeholder")}else{a.attr("placeholder",this.settings.placeholder)}a.triggerHandler("update",{force:true})},open:function(){var a=this;if(a.isLocked||a.isOpen||(a.settings.mode==="multi"&&a.isFull())){return}a.focus();a.isOpen=true;a.refreshState();a.$dropdown.css({visibility:"hidden",display:"block"});a.positionDropdown();a.$dropdown.css({visibility:"visible"});a.trigger("dropdown_open",a.$dropdown)},close:function(){var a=this;var b=a.isOpen;if(a.settings.mode==="single"&&a.items.length){a.hideInput()}a.isOpen=false;a.$dropdown.hide();a.setActiveOption(null);a.refreshState();if(b){a.trigger("dropdown_close",a.$dropdown)}},positionDropdown:function(){var a=this.$control;var b=this.settings.dropdownParent==="body"?a.offset():a.position();b.top+=a.outerHeight(true);this.$dropdown.css({width:a.outerWidth(),top:b.top,left:b.left})},clear:function(){var a=this;if(!a.items.length){return}a.$control.children(":not(input)").remove();a.items=[];a.lastQuery=null;a.setCaret(0);a.setActiveItem(null);a.updatePlaceholder();a.updateOriginalInput();a.refreshState();a.showInput();a.trigger("clear")},insertAtCaret:function(a){var b=Math.min(this.caretPos,this.items.length);if(b===0){this.$control.prepend(a)}else{$(this.$control[0].childNodes[b]).before(a)}this.setCaret(b+1)},deleteSelection:function(d){var b,a,j,k,l,g,f,h,c;var m=this;j=(d&&d.keyCode===KEY_BACKSPACE)?-1:1;k=getSelection(m.$control_input[0]);if(m.$activeOption&&!m.settings.hideSelected){f=m.getAdjacentOption(m.$activeOption,-1).attr("data-value")}l=[];if(m.$activeItems.length){c=m.$control.children(".active:"+(j>0?"last":"first"));g=m.$control.children(":not(input)").index(c);if(j>0){g++}for(b=0,a=m.$activeItems.length;b<a;b++){l.push($(m.$activeItems[b]).attr("data-value"))}if(d){d.preventDefault();d.stopPropagation()}}else{if((m.isFocused||m.settings.mode==="single")&&m.items.length){if(j<0&&k.start===0&&k.length===0){l.push(m.items[m.caretPos-1])}else{if(j>0&&k.start===m.$control_input.val().length){l.push(m.items[m.caretPos])}}}}if(!l.length||(typeof m.settings.onDelete==="function"&&m.settings.onDelete.apply(m,[l])===false)){return false}if(typeof g!=="undefined"){m.setCaret(g)}while(l.length){m.removeItem(l.pop())}m.showInput();m.positionDropdown();m.refreshOptions(true);if(f){h=m.getOption(f);if(h.length){m.setActiveOption(h)}}return true},advanceSelection:function(f,b){var c,g,h,i,d,a;var j=this;if(f===0){return}if(j.rtl){f*=-1}c=f>0?"last":"first";g=getSelection(j.$control_input[0]);if(j.isFocused&&!j.isInputHidden){i=j.$control_input.val().length;d=f<0?g.start===0&&g.length===0:g.start===i;if(d&&!i){j.advanceCaret(f,b)}}else{a=j.$control.children(".active:"+c);if(a.length){h=j.$control.children(":not(input)").index(a);j.setActiveItem(null);j.setCaret(f>0?h+1:h)}}},advanceCaret:function(f,d){var a=this,c,b;if(f===0){return}c=f>0?"next":"prev";if(a.isShiftDown){b=a.$control_input[c]();if(b.length){a.hideInput();a.setActiveItem(b);d&&d.preventDefault()}}else{a.setCaret(a.caretPos+f)}},setCaret:function(d){var b=this;if(b.settings.mode==="single"){d=b.items.length}else{d=Math.max(0,Math.min(b.items.length,d))}if(!b.isPending){var c,g,e,a,f;a=b.$control.children(":not(input)");for(c=0,g=a.length;c<g;c++){f=$(a[c]).detach();if(c<d){b.$control_input.before(f)}else{b.$control.append(f)}}}b.caretPos=d},lock:function(){this.close();this.isLocked=true;this.refreshState()},unlock:function(){this.isLocked=false;this.refreshState()},disable:function(){var a=this;a.$input.prop("disabled",true);a.isDisabled=true;a.lock()},enable:function(){var a=this;a.$input.prop("disabled",false);a.isDisabled=false;a.unlock()},destroy:function(){var a=this;var c=a.eventNS;var b=a.revertSettings;a.trigger("destroy");a.off();a.$wrapper.remove();a.$dropdown.remove();a.$input.html("").append(b.$children).removeAttr("tabindex").removeClass("selectized").attr({tabindex:b.tabindex}).show();a.$control_input.removeData("grow");a.$input.removeData("selectize");$(window).off(c);$(document).off(c);$(document.body).off(c);delete a.$input[0].selectize},render:function(i,c){var g,b,f;var d="";var a=false;var h=this;var e=/^[\t ]*<([a-z][a-z0-9\-_]*(?:\:[a-z][a-z0-9\-_]*)?)/i;if(i==="option"||i==="item"){g=hash_key(c[h.settings.valueField]);a=!!g}if(a){if(!isset(h.renderCache[i])){h.renderCache[i]={}}if(h.renderCache[i].hasOwnProperty(g)){return h.renderCache[i][g]}}d=h.settings.render[i].apply(this,[c,escape_html]);if(i==="option"||i==="option_create"){d=d.replace(e,"<$1 data-selectable")}if(i==="optgroup"){b=c[h.settings.optgroupValueField]||"";d=d.replace(e,'<$1 data-group="'+escape_replace(escape_html(b))+'"')}if(i==="option"||i==="item"){d=d.replace(e,'<$1 data-value="'+escape_replace(escape_html(g||""))+'"')}if(a){h.renderCache[i][g]=d}return d},clearCache:function(a){var b=this;if(typeof a==="undefined"){b.renderCache={}}else{delete b.renderCache[a]}},canCreate:function(b){var a=this;if(!a.settings.create){return false}var c=a.settings.createFilter;return b.length&&(typeof c!=="function"||c.apply(a,[b]))&&(typeof c!=="string"||new RegExp(c).test(b))&&(!(c instanceof RegExp)||c.test(b))}});