/* selectize.js - v0.11.2 | https://github.com/brianreavis/selectize.js | Apache License (v2) */
!function(d,c){"function"==typeof define&&define.amd?define(["jquery","sifter","microplugin"],c):"object"==typeof exports?module.exports=c(require("jquery"),require("sifter"),require("microplugin")):d.Selectize=c(d.jQuery,d.Sifter,d.MicroPlugin)}(this,function(ay,ax,aw){var av=function(f,e){if("string"!=typeof e||e.length){var h="string"==typeof e?new RegExp(e,"i"):e,g=function(d){var c=0;if(3===d.nodeType){var p=d.data.search(h);if(p>=0&&d.data.length>0){var o=d.data.match(h),n=document.createElement("span");n.className="highlight";var m=d.splitText(p),l=(m.splitText(o[0].length),m.cloneNode(!0));n.appendChild(l),m.parentNode.replaceChild(n,m),c=1}}else{if(1===d.nodeType&&d.childNodes&&!/(script|style)/i.test(d.tagName)){for(var k=0;k<d.childNodes.length;++k){k+=g(d.childNodes[k])}}}return c};return f.each(function(){g(this)})}},au=function(){};au.prototype={on:function(d,c){this._events=this._events||{},this._events[d]=this._events[d]||[],this._events[d].push(c)},off:function(e,d){var f=arguments.length;return 0===f?delete this._events:1===f?delete this._events[e]:(this._events=this._events||{},void (e in this._events!=!1&&this._events[e].splice(this._events[e].indexOf(d),1)))},trigger:function(d){if(this._events=this._events||{},d in this._events!=!1){for(var c=0;c<this._events[d].length;c++){this._events[d][c].apply(this,Array.prototype.slice.call(arguments,1))}}}},au.mixin=function(e){for(var d=["on","off","trigger"],f=0;f<d.length;f++){e.prototype[d[f]]=au.prototype[d[f]]}};var at=/Mac/.test(navigator.userAgent),ar=65,aq=13,ap=27,ao=37,an=38,am=80,al=39,ak=40,aj=78,ai=8,ah=46,ag=16,af=at?91:17,ae=at?18:17,ad=9,ac=1,ab=2,aa=function(b){return"undefined"!=typeof b},Z=function(b){return"undefined"==typeof b||null===b?null:"boolean"==typeof b?b?"1":"0":b+""},Y=function(b){return(b+"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")},X=function(b){return(b+"").replace(/\$/g,"$$$$")},W={};W.before=function(f,e,h){var g=f[e];f[e]=function(){return h.apply(f,arguments),g.apply(f,arguments)}},W.after=function(f,e,h){var g=f[e];f[e]=function(){var a=g.apply(f,arguments);return h.apply(f,arguments),a}};var V=function(a,j){if(!ay.isArray(j)){return j}var i,h,g={};for(i=0,h=j.length;h>i;i++){j[i].hasOwnProperty(a)&&(g[j[i][a]]=j[i])}return g},U=function(d){var c=!1;return function(){c||(c=!0,d.apply(this,arguments))}},T=function(e,d){var f;return function(){var b=this,a=arguments;window.clearTimeout(f),f=window.setTimeout(function(){e.apply(b,a)},d)}},S=function(h,g,l){var k,j=h.trigger,i={};h.trigger=function(){var a=arguments[0];return -1===g.indexOf(a)?j.apply(h,arguments):void (i[a]=arguments)},l.apply(h,[]),h.trigger=j;for(k in i){i.hasOwnProperty(k)&&j.apply(h,i[k])}},R=function(f,e,h,g){f.on(e,h,function(a){for(var d=a.target;d&&d.parentNode!==f[0];){d=d.parentNode}return a.currentTarget=d,g.apply(this,[a])})},Q=function(f){var e={};if("selectionStart" in f){e.start=f.selectionStart,e.length=f.selectionEnd-e.start}else{if(document.selection){f.focus();var h=document.selection.createRange(),g=document.selection.createRange().text.length;h.moveStart("character",-f.value.length),e.start=h.text.length-g,e.length=g}}return e},P=function(h,g,l){var k,j,i={};if(l){for(k=0,j=l.length;j>k;k++){i[l[k]]=h.css(l[k])}}else{i=h.css()}g.css(i)},O=function(a,h){if(!a){return 0}var g=ay("<test>").css({position:"absolute",top:-99999,left:-99999,width:"auto",padding:0,whiteSpace:"pre"}).text(a).appendTo("body");P(h,g,["letterSpacing","fontSize","fontFamily","fontWeight","textTransform"]);var f=g.width();return g.remove(),f},N=function(e){var d=null,f=function(t,s){var r,q,p,o,n,m,b,a;t=t||window.event||{},s=s||{},t.metaKey||t.altKey||(s.force||e.data("grow")!==!1)&&(r=e.val(),t.type&&"keydown"===t.type.toLowerCase()&&(q=t.keyCode,p=q>=97&&122>=q||q>=65&&90>=q||q>=48&&57>=q||32===q,q===ah||q===ai?(a=Q(e[0]),a.length?r=r.substring(0,a.start)+r.substring(a.start+a.length):q===ai&&a.start?r=r.substring(0,a.start-1)+r.substring(a.start+1):q===ah&&"undefined"!=typeof a.start&&(r=r.substring(0,a.start)+r.substring(a.start+1))):p&&(m=t.shiftKey,b=String.fromCharCode(t.keyCode),b=m?b.toUpperCase():b.toLowerCase(),r+=b)),o=e.attr("placeholder"),!r&&o&&(r=o),n=O(r,e)+4,n!==d&&(d=n,e.width(n),e.triggerHandler("resize")))};e.on("keydown keyup update blur",f),f()},M=function(l,k){var j,i,b=this;i=l[0],i.selectize=b;var a=window.getComputedStyle&&window.getComputedStyle(i,null);j=a?a.getPropertyValue("direction"):i.currentStyle&&i.currentStyle.direction,j=j||l.parents("[dir]:first").attr("dir")||"",ay.extend(b,{settings:k,$input:l,tagType:"select"===i.tagName.toLowerCase()?ac:ab,rtl:/rtl/i.test(j),eventNS:".selectize"+ ++M.count,highlightedValue:null,isOpen:!1,isDisabled:!1,isRequired:l.is("[required]"),isInvalid:!1,isLocked:!1,isFocused:!1,isInputHidden:!1,isSetup:!1,isShiftDown:!1,isCmdDown:!1,isCtrlDown:!1,ignoreFocus:!1,ignoreBlur:!1,ignoreHover:!1,hasOptions:!1,currentResults:null,lastValue:"",caretPos:0,loading:0,loadedSearches:{},$activeOption:null,$activeItems:[],optgroups:{},options:{},userOptions:{},items:[],renderCache:{},onSearchChange:null===k.loadThrottle?b.onSearchChange:T(b.onSearchChange,k.loadThrottle)}),b.sifter=new ax(this.options,{diacritics:k.diacritics}),ay.extend(b.options,V(k.valueField,k.options)),delete b.settings.options,ay.extend(b.optgroups,V(k.optgroupValueField,k.optgroups)),delete b.settings.optgroups,b.settings.mode=b.settings.mode||(1===b.settings.maxItems?"single":"multi"),"boolean"!=typeof b.settings.hideSelected&&(b.settings.hideSelected="multi"===b.settings.mode),b.initializePlugins(b.settings.plugins),b.setupCallbacks(),b.setupTemplates(),b.setup()};return au.mixin(M),aw.mixin(M),ay.extend(M.prototype,{setup:function(){var E,D,C,B,A,z,y,x,w,v,t=this,s=t.settings,r=t.eventNS,f=ay(window),a=ay(document),F=t.$input;y=t.settings.mode,x=F.attr("tabindex")||"",w=F.attr("class")||"",E=ay("<div>").addClass(s.wrapperClass).addClass(w).addClass(y),D=ay("<div>").addClass(s.inputClass).addClass("items").appendTo(E),C=ay('<input type="text" autocomplete="off" />').appendTo(D).attr("tabindex",x),z=ay(s.dropdownParent||E),B=ay("<div>").addClass(s.dropdownClass).addClass(y).hide().appendTo(z),A=ay("<div>").addClass(s.dropdownContentClass).appendTo(B),t.settings.copyClassesToDropdown&&B.addClass(w),E.css({width:F[0].style.width}),t.plugins.names.length&&(v="plugin-"+t.plugins.names.join(" plugin-"),E.addClass(v),B.addClass(v)),(null===s.maxItems||s.maxItems>1)&&t.tagType===ac&&F.attr("multiple","multiple"),t.settings.placeholder&&C.attr("placeholder",s.placeholder),F.attr("autocorrect")&&C.attr("autocorrect",F.attr("autocorrect")),F.attr("autocapitalize")&&C.attr("autocapitalize",F.attr("autocapitalize")),t.$wrapper=E,t.$control=D,t.$control_input=C,t.$dropdown=B,t.$dropdown_content=A,B.on("mouseenter","[data-selectable]",function(){return t.onOptionHover.apply(t,arguments)}),B.on("mousedown","[data-selectable]",function(){return t.onOptionSelect.apply(t,arguments)}),R(D,"mousedown","*:not(input)",function(){return t.onItemSelect.apply(t,arguments)}),N(C),D.on({mousedown:function(){return t.onMouseDown.apply(t,arguments)},click:function(){return t.onClick.apply(t,arguments)}}),C.on({mousedown:function(b){b.stopPropagation()},keydown:function(){return t.onKeyDown.apply(t,arguments)},keyup:function(){return t.onKeyUp.apply(t,arguments)},keypress:function(){return t.onKeyPress.apply(t,arguments)},resize:function(){t.positionDropdown.apply(t,[])},blur:function(){return t.onBlur.apply(t,arguments)},focus:function(){return t.ignoreBlur=!1,t.onFocus.apply(t,arguments)},paste:function(){return t.onPaste.apply(t,arguments)}}),a.on("keydown"+r,function(b){t.isCmdDown=b[at?"metaKey":"ctrlKey"],t.isCtrlDown=b[at?"altKey":"ctrlKey"],t.isShiftDown=b.shiftKey}),a.on("keyup"+r,function(b){b.keyCode===ae&&(t.isCtrlDown=!1),b.keyCode===ag&&(t.isShiftDown=!1),b.keyCode===af&&(t.isCmdDown=!1)}),a.on("mousedown"+r,function(b){if(t.isFocused){if(b.target===t.$dropdown[0]||b.target.parentNode===t.$dropdown[0]){return !1}t.$control.has(b.target).length||b.target===t.$control[0]||t.blur()}}),f.on(["scroll"+r,"resize"+r].join(" "),function(){t.isOpen&&t.positionDropdown.apply(t,arguments)}),f.on("mousemove"+r,function(){t.ignoreHover=!1}),this.revertSettings={$children:F.children().detach(),tabindex:F.attr("tabindex")},F.attr("tabindex",-1).hide().after(t.$wrapper),ay.isArray(s.items)&&(t.setValue(s.items),delete s.items),F[0].validity&&F.on("invalid"+r,function(b){b.preventDefault(),t.isInvalid=!0,t.refreshState()}),t.updateOriginalInput(),t.refreshItems(),t.refreshState(),t.updatePlaceholder(),t.isSetup=!0,F.is(":disabled")&&t.disable(),t.on("change",this.onChange),F.data("selectize",t),F.addClass("selectized"),t.trigger("initialize"),s.preload===!0&&t.onSearchChange("")},setupTemplates:function(){var a=this,h=a.settings.labelField,g=a.settings.optgroupLabelField,f={optgroup:function(b){return'<div class="optgroup">'+b.html+"</div>"},optgroup_header:function(d,c){return'<div class="optgroup-header">'+c(d[g])+"</div>"},option:function(d,c){return'<div class="option">'+c(d[h])+"</div>"},item:function(d,c){return'<div class="item">'+c(d[h])+"</div>"},option_create:function(d,c){return'<div class="create">Add <strong>'+c(d.input)+"</strong>&hellip;</div>"}};a.settings.render=ay.extend({},f,a.settings.render)},setupCallbacks:function(){var e,d,f={initialize:"onInitialize",change:"onChange",item_add:"onItemAdd",item_remove:"onItemRemove",clear:"onClear",option_add:"onOptionAdd",option_remove:"onOptionRemove",option_clear:"onOptionClear",dropdown_open:"onDropdownOpen",dropdown_close:"onDropdownClose",type:"onType",load:"onLoad"};for(e in f){f.hasOwnProperty(e)&&(d=this.settings[f[e]],d&&this.on(e,d))}},onClick:function(d){var c=this;c.isFocused||(c.focus(),d.preventDefault())},onMouseDown:function(a){var f=this,e=a.isDefaultPrevented();ay(a.target);if(f.isFocused){if(a.target!==f.$control_input[0]){return"single"===f.settings.mode?f.isOpen?f.close():f.open():e||f.setActiveItem(null),!1}}else{e||window.setTimeout(function(){f.focus()},0)}},onChange:function(){this.$input.trigger("change")},onPaste:function(d){var c=this;(c.isFull()||c.isInputHidden||c.isLocked)&&d.preventDefault()},onKeyPress:function(d){if(this.isLocked){return d&&d.preventDefault()}var c=String.fromCharCode(d.keyCode||d.which);return this.settings.create&&c===this.settings.delimiter?(this.createItem(),d.preventDefault(),!1):void 0},onKeyDown:function(f){var e=(f.target===this.$control_input[0],this);if(e.isLocked){return void (f.keyCode!==ad&&f.preventDefault())}switch(f.keyCode){case ar:if(e.isCmdDown){return void e.selectAll()}break;case ap:return void e.close();case aj:if(!f.ctrlKey||f.altKey){break}case ak:if(!e.isOpen&&e.hasOptions){e.open()}else{if(e.$activeOption){e.ignoreHover=!0;var h=e.getAdjacentOption(e.$activeOption,1);h.length&&e.setActiveOption(h,!0,!0)}}return void f.preventDefault();case am:if(!f.ctrlKey||f.altKey){break}case an:if(e.$activeOption){e.ignoreHover=!0;var g=e.getAdjacentOption(e.$activeOption,-1);g.length&&e.setActiveOption(g,!0,!0)}return void f.preventDefault();case aq:return e.isOpen&&e.$activeOption&&e.onOptionSelect({currentTarget:e.$activeOption}),void f.preventDefault();case ao:return void e.advanceSelection(-1,f);case al:return void e.advanceSelection(1,f);case ad:return e.settings.selectOnTab&&e.isOpen&&e.$activeOption&&(e.onOptionSelect({currentTarget:e.$activeOption}),f.preventDefault()),void (e.settings.create&&e.createItem()&&f.preventDefault());case ai:case ah:return void e.deleteSelection(f)}return !e.isFull()&&!e.isInputHidden||(at?f.metaKey:f.ctrlKey)?void 0:void f.preventDefault()},onKeyUp:function(e){var d=this;if(d.isLocked){return e&&e.preventDefault()}var f=d.$control_input.val()||"";d.lastValue!==f&&(d.lastValue=f,d.onSearchChange(f),d.refreshOptions(),d.trigger("type",f))},onSearchChange:function(e){var d=this,f=d.settings.load;f&&(d.loadedSearches.hasOwnProperty(e)||(d.loadedSearches[e]=!0,d.load(function(a){f.apply(d,[e,a])})))},onFocus:function(d){var c=this;return c.isFocused=!0,c.isDisabled?(c.blur(),d&&d.preventDefault(),!1):void (c.ignoreFocus||("focus"===c.settings.preload&&c.onSearchChange(""),c.$activeItems.length||(c.showInput(),c.setActiveItem(null),c.refreshOptions(!!c.settings.openOnFocus)),c.refreshState()))},onBlur:function(d){var c=this;if(c.isFocused=!1,!c.ignoreFocus){if(!c.ignoreBlur&&document.activeElement===c.$dropdown_content[0]){return c.ignoreBlur=!0,void c.onFocus(d)}c.settings.create&&c.settings.createOnBlur&&c.createItem(!1),c.close(),c.setTextboxValue(""),c.setActiveItem(null),c.setActiveOption(null),c.setCaret(c.items.length),c.refreshState()}},onOptionHover:function(b){this.ignoreHover||this.setActiveOption(b.currentTarget,!1)},onOptionSelect:function(a){var h,g,f=this;a.preventDefault&&(a.preventDefault(),a.stopPropagation()),g=ay(a.currentTarget),g.hasClass("create")?f.createItem():(h=g.attr("data-value"),"undefined"!=typeof h&&(f.lastQuery=null,f.setTextboxValue(""),f.addItem(h),!f.settings.hideSelected&&a.type&&/mouse/.test(a.type)&&f.setActiveOption(f.getOption(h))))},onItemSelect:function(d){var c=this;c.isLocked||"multi"===c.settings.mode&&(d.preventDefault(),c.setActiveItem(d.currentTarget,d))},load:function(e){var d=this,f=d.$wrapper.addClass("loading");d.loading++,e.apply(d,[function(b){d.loading=Math.max(d.loading-1,0),b&&b.length&&(d.addOption(b),d.refreshOptions(d.isFocused&&!d.isInputHidden)),d.loading||f.removeClass("loading"),d.trigger("load",b)}])},setTextboxValue:function(e){var d=this.$control_input,f=d.val()!==e;f&&(d.val(e).triggerHandler("update"),this.lastValue=e)},getValue:function(){return this.tagType===ac&&this.$input.attr("multiple")?this.items:this.items.join(this.settings.delimiter)},setValue:function(b){S(this,["change"],function(){this.clear(),this.addItems(b)})},setActiveItem:function(v,u){var t,s,r,q,p,o,n,m,a=this;if("single"!==a.settings.mode){if(v=ay(v),!v.length){return ay(a.$activeItems).removeClass("active"),a.$activeItems=[],void (a.isFocused&&a.showInput())}if(t=u&&u.type.toLowerCase(),"mousedown"===t&&a.isShiftDown&&a.$activeItems.length){for(m=a.$control.children(".active:last"),q=Array.prototype.indexOf.apply(a.$control[0].childNodes,[m[0]]),p=Array.prototype.indexOf.apply(a.$control[0].childNodes,[v[0]]),q>p&&(n=q,q=p,p=n),s=q;p>=s;s++){o=a.$control[0].childNodes[s],-1===a.$activeItems.indexOf(o)&&(ay(o).addClass("active"),a.$activeItems.push(o))}u.preventDefault()}else{"mousedown"===t&&a.isCtrlDown||"keydown"===t&&this.isShiftDown?v.hasClass("active")?(r=a.$activeItems.indexOf(v[0]),a.$activeItems.splice(r,1),v.removeClass("active")):a.$activeItems.push(v.addClass("active")[0]):(ay(a.$activeItems).removeClass("active"),a.$activeItems=[v.addClass("active")[0]])}a.hideInput(),this.isFocused||a.focus()}},setActiveOption:function(r,q,p){var o,n,m,l,k,a=this;a.$activeOption&&a.$activeOption.removeClass("active"),a.$activeOption=null,r=ay(r),r.length&&(a.$activeOption=r.addClass("active"),(q||!aa(q))&&(o=a.$dropdown_content.height(),n=a.$activeOption.outerHeight(!0),q=a.$dropdown_content.scrollTop()||0,m=a.$activeOption.offset().top-a.$dropdown_content.offset().top+q,l=m,k=m-o+n,m+n>o+q?a.$dropdown_content.stop().animate({scrollTop:k},p?a.settings.scrollDuration:0):q>m&&a.$dropdown_content.stop().animate({scrollTop:l},p?a.settings.scrollDuration:0)))},selectAll:function(){var b=this;"single"!==b.settings.mode&&(b.$activeItems=Array.prototype.slice.apply(b.$control.children(":not(input)").addClass("active")),b.$activeItems.length&&(b.hideInput(),b.close()),b.focus())},hideInput:function(){var b=this;b.setTextboxValue(""),b.$control_input.css({opacity:0,position:"absolute",left:b.rtl?10000:-10000}),b.isInputHidden=!0},showInput:function(){this.$control_input.css({opacity:1,position:"relative",left:0}),this.isInputHidden=!1},focus:function(){var b=this;b.isDisabled||(b.ignoreFocus=!0,b.$control_input[0].focus(),window.setTimeout(function(){b.ignoreFocus=!1,b.onFocus()},0))},blur:function(){this.$control_input.trigger("blur")},getScoreFunction:function(b){return this.sifter.getScoreFunction(b,this.getSearchOptions())},getSearchOptions:function(){var d=this.settings,c=d.sortField;return"string"==typeof c&&(c={field:c}),{fields:d.searchField,conjunction:d.searchConjunction,sort:c}},search:function(a){var n,m,l,k=this,j=k.settings,i=this.getSearchOptions();if(j.score&&(l=k.settings.score.apply(this,[a]),"function"!=typeof l)){throw new Error('Selectize "score" setting must be a function that returns a function')}if(a!==k.lastQuery?(k.lastQuery=a,m=k.sifter.search(a,ay.extend(i,{score:l})),k.currentResults=m):m=ay.extend(!0,{},k.currentResults),j.hideSelected){for(n=m.items.length-1;n>=0;n--){-1!==k.items.indexOf(Z(m.items[n].id))&&m.items.splice(n,1)}}return m},refreshOptions:function(aE){var aD,aC,aB,aA,az,L,K,J,I,H,G,F,E,D,C,B;"undefined"==typeof aE&&(aE=!0);var A=this,z=ay.trim(A.$control_input.val()),y=A.search(z),d=A.$dropdown_content,a=A.$activeOption&&Z(A.$activeOption.attr("data-value"));if(aA=y.items.length,"number"==typeof A.settings.maxOptions&&(aA=Math.min(aA,A.settings.maxOptions)),az={},A.settings.optgroupOrder){for(L=A.settings.optgroupOrder,aD=0;aD<L.length;aD++){az[L[aD]]=[]}}else{L=[]}for(aD=0;aA>aD;aD++){for(K=A.options[y.items[aD].id],J=A.render("option",K),I=K[A.settings.optgroupField]||"",H=ay.isArray(I)?I:[I],aC=0,aB=H&&H.length;aB>aC;aC++){I=H[aC],A.optgroups.hasOwnProperty(I)||(I=""),az.hasOwnProperty(I)||(az[I]=[],L.push(I)),az[I].push(J)}}for(G=[],aD=0,aA=L.length;aA>aD;aD++){I=L[aD],A.optgroups.hasOwnProperty(I)&&az[I].length?(F=A.render("optgroup_header",A.optgroups[I])||"",F+=az[I].join(""),G.push(A.render("optgroup",ay.extend({},A.optgroups[I],{html:F})))):G.push(az[I].join(""))}if(d.html(G.join("")),A.settings.highlight&&y.query.length&&y.tokens.length){for(aD=0,aA=y.tokens.length;aA>aD;aD++){av(d,y.tokens[aD].regex)}}if(!A.settings.hideSelected){for(aD=0,aA=A.items.length;aA>aD;aD++){A.getOption(A.items[aD]).addClass("selected")}}E=A.canCreate(z),E&&(d.prepend(A.render("option_create",{input:z})),B=ay(d[0].childNodes[0])),A.hasOptions=y.items.length>0||E,A.hasOptions?(y.items.length>0?(C=a&&A.getOption(a),C&&C.length?D=C:"single"===A.settings.mode&&A.items.length&&(D=A.getOption(A.items[0])),D&&D.length||(D=B&&!A.settings.addPrecedence?A.getAdjacentOption(B,1):d.find("[data-selectable]:first"))):D=B,A.setActiveOption(D),aE&&!A.isOpen&&A.open()):(A.setActiveOption(null),aE&&A.isOpen&&A.close())},addOption:function(a){var j,i,h,g=this;if(ay.isArray(a)){for(j=0,i=a.length;i>j;j++){g.addOption(a[j])}}else{h=Z(a[g.settings.valueField]),"string"!=typeof h||g.options.hasOwnProperty(h)||(g.userOptions[h]=!0,g.options[h]=a,g.lastQuery=null,g.trigger("option_add",h,a))}},addOptionGroup:function(d,c){this.optgroups[d]=c,this.trigger("optgroup_add",d,c)},updateOption:function(r,q){var p,o,n,m,l,k,a=this;if(r=Z(r),n=Z(q[a.settings.valueField]),null!==r&&a.options.hasOwnProperty(r)){if("string"!=typeof n){throw new Error("Value must be set in option data")}n!==r&&(delete a.options[r],m=a.items.indexOf(r),-1!==m&&a.items.splice(m,1,n)),a.options[n]=q,l=a.renderCache.item,k=a.renderCache.option,l&&(delete l[r],delete l[n]),k&&(delete k[r],delete k[n]),-1!==a.items.indexOf(n)&&(p=a.getItem(r),o=ay(a.render("item",q)),p.hasClass("active")&&o.addClass("active"),p.replaceWith(o)),a.lastQuery=null,a.isOpen&&a.refreshOptions(!1)}},removeOption:function(f){var e=this;f=Z(f);var h=e.renderCache.item,g=e.renderCache.option;h&&delete h[f],g&&delete g[f],delete e.userOptions[f],delete e.options[f],e.lastQuery=null,e.trigger("option_remove",f),e.removeItem(f)},clearOptions:function(){var b=this;b.loadedSearches={},b.userOptions={},b.renderCache={},b.options=b.sifter.items={},b.lastQuery=null,b.trigger("option_clear"),b.clear()},getOption:function(b){return this.getElementWithValue(b,this.$dropdown_content.find("[data-selectable]"))},getAdjacentOption:function(a,h){var g=this.$dropdown.find("[data-selectable]"),f=g.index(a)+h;return f>=0&&f<g.length?g.eq(f):ay()},getElementWithValue:function(a,h){if(a=Z(a),"undefined"!=typeof a&&null!==a){for(var g=0,f=h.length;f>g;g++){if(h[g].getAttribute("data-value")===a){return ay(h[g])}}}return ay()},getItem:function(b){return this.getElementWithValue(b,this.$control.children())},addItems:function(a){for(var h=ay.isArray(a)?a:[a],g=0,f=h.length;f>g;g++){this.isPending=f-1>g,this.addItem(h[g])}},addItem:function(a){S(this,["change"],function(){var o,n,m,l,k,j=this,b=j.settings.mode;return a=Z(a),-1!==j.items.indexOf(a)?void ("single"===b&&j.close()):void (j.options.hasOwnProperty(a)&&("single"===b&&j.clear(),"multi"===b&&j.isFull()||(o=ay(j.render("item",j.options[a])),k=j.isFull(),j.items.splice(j.caretPos,0,a),j.insertAtCaret(o),(!j.isPending||!k&&j.isFull())&&j.refreshState(),j.isSetup&&(m=j.$dropdown_content.find("[data-selectable]"),j.isPending||(n=j.getOption(a),l=j.getAdjacentOption(n,1).attr("data-value"),j.refreshOptions(j.isFocused&&"single"!==b),l&&j.setActiveOption(j.getOption(l))),!m.length||j.isFull()?j.close():j.positionDropdown(),j.updatePlaceholder(),j.trigger("item_add",a,o),j.updateOriginalInput()))))})},removeItem:function(g){var f,j,i,h=this;f="object"==typeof g?g:h.getItem(g),g=Z(f.attr("data-value")),j=h.items.indexOf(g),-1!==j&&(f.remove(),f.hasClass("active")&&(i=h.$activeItems.indexOf(f[0]),h.$activeItems.splice(i,1)),h.items.splice(j,1),h.lastQuery=null,!h.settings.persist&&h.userOptions.hasOwnProperty(g)&&h.removeOption(g),j<h.caretPos&&h.setCaret(h.caretPos-1),h.refreshState(),h.updatePlaceholder(),h.updateOriginalInput(),h.positionDropdown(),h.trigger("item_remove",g))},createItem:function(a){var n=this,m=ay.trim(n.$control_input.val()||""),l=n.caretPos;if(!n.canCreate(m)){return !1}n.lock(),"undefined"==typeof a&&(a=!0);var k="function"==typeof n.settings.create?this.settings.create:function(d){var c={};return c[n.settings.labelField]=d,c[n.settings.valueField]=d,c},j=U(function(b){if(n.unlock(),b&&"object"==typeof b){var c=Z(b[n.settings.valueField]);"string"==typeof c&&(n.setTextboxValue(""),n.addOption(b),n.setCaret(l),n.addItem(c),n.refreshOptions(a&&"single"!==n.settings.mode))}}),i=k.apply(this,[m,j]);return"undefined"!=typeof i&&j(i),!0},refreshItems:function(){if(this.lastQuery=null,this.isSetup){for(var b=0;b<this.items.length;b++){this.addItem(this.items)}}this.refreshState(),this.updateOriginalInput()},refreshState:function(){var d,c=this;c.isRequired&&(c.items.length&&(c.isInvalid=!1),c.$control_input.prop("required",d)),c.refreshClasses()},refreshClasses:function(){var a=this,f=a.isFull(),e=a.isLocked;a.$wrapper.toggleClass("rtl",a.rtl),a.$control.toggleClass("focus",a.isFocused).toggleClass("disabled",a.isDisabled).toggleClass("required",a.isRequired).toggleClass("invalid",a.isInvalid).toggleClass("locked",e).toggleClass("full",f).toggleClass("not-full",!f).toggleClass("input-active",a.isFocused&&!a.isInputHidden).toggleClass("dropdown-active",a.isOpen).toggleClass("has-options",!ay.isEmptyObject(a.options)).toggleClass("has-items",a.items.length>0),a.$control_input.data("grow",!f&&!e)},isFull:function(){return null!==this.settings.maxItems&&this.items.length>=this.settings.maxItems},updateOriginalInput:function(){var f,e,h,g=this;if(g.tagType===ac){for(h=[],f=0,e=g.items.length;e>f;f++){h.push('<option value="'+Y(g.items[f])+'" selected="selected"></option>')}h.length||this.$input.attr("multiple")||h.push('<option value="" selected="selected"></option>'),g.$input.html(h.join(""))}else{g.$input.val(g.getValue()),g.$input.attr("value",g.$input.val())}g.isSetup&&g.trigger("change",g.$input.val())},updatePlaceholder:function(){if(this.settings.placeholder){var b=this.$control_input;this.items.length?b.removeAttr("placeholder"):b.attr("placeholder",this.settings.placeholder),b.triggerHandler("update",{force:!0})}},open:function(){var b=this;b.isLocked||b.isOpen||"multi"===b.settings.mode&&b.isFull()||(b.focus(),b.isOpen=!0,b.refreshState(),b.$dropdown.css({visibility:"hidden",display:"block"}),b.positionDropdown(),b.$dropdown.css({visibility:"visible"}),b.trigger("dropdown_open",b.$dropdown))},close:function(){var d=this,c=d.isOpen;"single"===d.settings.mode&&d.items.length&&d.hideInput(),d.isOpen=!1,d.$dropdown.hide(),d.setActiveOption(null),d.refreshState(),c&&d.trigger("dropdown_close",d.$dropdown)},positionDropdown:function(){var d=this.$control,c="body"===this.settings.dropdownParent?d.offset():d.position();c.top+=d.outerHeight(!0),this.$dropdown.css({width:d.outerWidth(),top:c.top,left:c.left})},clear:function(){var b=this;b.items.length&&(b.$control.children(":not(input)").remove(),b.items=[],b.lastQuery=null,b.setCaret(0),b.setActiveItem(null),b.updatePlaceholder(),b.updateOriginalInput(),b.refreshState(),b.showInput(),b.trigger("clear"))},insertAtCaret:function(a){var d=Math.min(this.caretPos,this.items.length);0===d?this.$control.prepend(a):ay(this.$control[0].childNodes[d]).before(a),this.setCaret(d+1)},deleteSelection:function(v){var u,t,s,r,q,p,o,n,m,a=this;if(s=v&&v.keyCode===ai?-1:1,r=Q(a.$control_input[0]),a.$activeOption&&!a.settings.hideSelected&&(o=a.getAdjacentOption(a.$activeOption,-1).attr("data-value")),q=[],a.$activeItems.length){for(m=a.$control.children(".active:"+(s>0?"last":"first")),p=a.$control.children(":not(input)").index(m),s>0&&p++,u=0,t=a.$activeItems.length;t>u;u++){q.push(ay(a.$activeItems[u]).attr("data-value"))}v&&(v.preventDefault(),v.stopPropagation())}else{(a.isFocused||"single"===a.settings.mode)&&a.items.length&&(0>s&&0===r.start&&0===r.length?q.push(a.items[a.caretPos-1]):s>0&&r.start===a.$control_input.val().length&&q.push(a.items[a.caretPos]))}if(!q.length||"function"==typeof a.settings.onDelete&&a.settings.onDelete.apply(a,[q])===!1){return !1}for("undefined"!=typeof p&&a.setCaret(p);q.length;){a.removeItem(q.pop())}return a.showInput(),a.positionDropdown(),a.refreshOptions(!0),o&&(n=a.getOption(o),n.length&&a.setActiveOption(n)),!0},advanceSelection:function(r,q){var p,o,n,m,l,k,j=this;0!==r&&(j.rtl&&(r*=-1),p=r>0?"last":"first",o=Q(j.$control_input[0]),j.isFocused&&!j.isInputHidden?(m=j.$control_input.val().length,l=0>r?0===o.start&&0===o.length:o.start===m,l&&!m&&j.advanceCaret(r,q)):(k=j.$control.children(".active:"+p),k.length&&(n=j.$control.children(":not(input)").index(k),j.setActiveItem(null),j.setCaret(r>0?n+1:n))))},advanceCaret:function(g,f){var j,i,h=this;0!==g&&(j=g>0?"next":"prev",h.isShiftDown?(i=h.$control_input[j](),i.length&&(h.hideInput(),h.setActiveItem(i),f&&f.preventDefault())):h.setCaret(h.caretPos+g))},setCaret:function(a){var l=this;if(a="single"===l.settings.mode?l.items.length:Math.max(0,Math.min(l.items.length,a)),!l.isPending){var k,j,i,h;for(i=l.$control.children(":not(input)"),k=0,j=i.length;j>k;k++){h=ay(i[k]).detach(),a>k?l.$control_input.before(h):l.$control.append(h)}}l.caretPos=a},lock:function(){this.close(),this.isLocked=!0,this.refreshState()},unlock:function(){this.isLocked=!1,this.refreshState()},disable:function(){var b=this;b.$input.prop("disabled",!0),b.isDisabled=!0,b.lock()},enable:function(){var b=this;b.$input.prop("disabled",!1),b.isDisabled=!1,b.unlock()},destroy:function(){var a=this,f=a.eventNS,e=a.revertSettings;a.trigger("destroy"),a.off(),a.$wrapper.remove(),a.$dropdown.remove(),a.$input.html("").append(e.$children).removeAttr("tabindex").removeClass("selectized").attr({tabindex:e.tabindex}).show(),a.$control_input.removeData("grow"),a.$input.removeData("selectize"),ay(window).off(f),ay(document).off(f),ay(document.body).off(f),delete a.$input[0].selectize},render:function(j,i){var p,o,n="",m=!1,l=this,k=/^[\t ]*<([a-z][a-z0-9\-_]*(?:\:[a-z][a-z0-9\-_]*)?)/i;return("option"===j||"item"===j)&&(p=Z(i[l.settings.valueField]),m=!!p),m&&(aa(l.renderCache[j])||(l.renderCache[j]={}),l.renderCache[j].hasOwnProperty(p))?l.renderCache[j][p]:(n=l.settings.render[j].apply(this,[i,Y]),("option"===j||"option_create"===j)&&(n=n.replace(k,"<$1 data-selectable")),"optgroup"===j&&(o=i[l.settings.optgroupValueField]||"",n=n.replace(k,'<$1 data-group="'+X(Y(o))+'"')),("option"===j||"item"===j)&&(n=n.replace(k,'<$1 data-value="'+X(Y(p||""))+'"')),m&&(l.renderCache[j][p]=n),n)},clearCache:function(d){var c=this;"undefined"==typeof d?c.renderCache={}:delete c.renderCache[d]},canCreate:function(e){var d=this;if(!d.settings.create){return !1}var f=d.settings.createFilter;return !(!e.length||"function"==typeof f&&!f.apply(d,[e])||"string"==typeof f&&!new RegExp(f).test(e)||f instanceof RegExp&&!f.test(e))}}),M.count=0,M.defaults={plugins:[],delimiter:",",persist:!0,diacritics:!0,create:!1,createOnBlur:!1,createFilter:null,highlight:!0,openOnFocus:!0,maxOptions:1000,maxItems:null,hideSelected:null,addPrecedence:!1,selectOnTab:!1,preload:!1,allowEmptyOption:!1,scrollDuration:60,loadThrottle:300,dataAttr:"data-data",optgroupField:"optgroup",valueField:"value",labelField:"text",optgroupLabelField:"label",optgroupValueField:"value",optgroupOrder:null,sortField:"$order",searchField:["text"],searchConjunction:"and",mode:null,wrapperClass:"selectize-control",inputClass:"selectize-input",dropdownClass:"selectize-dropdown",dropdownContentClass:"selectize-dropdown-content",dropdownParent:null,copyClassesToDropdown:!0,render:{}},ay.fn.selectize=function(v){var u=ay.fn.selectize.defaults,t=ay.extend({},u,v),s=t.dataAttr,r=t.labelField,q=t.valueField,p=t.optgroupField,o=t.optgroupLabelField,n=t.optgroupValueField,m=function(d,y){var x,w,l,g,f=ay.trim(d.val()||"");if(t.allowEmptyOption||f.length){for(l=f.split(t.delimiter),x=0,w=l.length;w>x;x++){g={},g[r]=l[x],g[q]=l[x],y.options[l[x]]=g}y.items=l}},a=function(y,x){var w,j,i,h,g=0,f=x.options,e=function(k){var c=s&&k.attr(s);return"string"==typeof c&&c.length?JSON.parse(c):null},d=function(c,A){var l,k;if(c=ay(c),l=c.attr("value")||"",l.length||t.allowEmptyOption){if(f.hasOwnProperty(l)){return void (A&&(f[l].optgroup?ay.isArray(f[l].optgroup)?f[l].optgroup.push(A):f[l].optgroup=[f[l].optgroup,A]:f[l].optgroup=A))}k=e(c)||{},k[r]=k[r]||c.text(),k[q]=k[q]||l,k[p]=k[p]||A,k.$order=++g,f[l]=k,c.is(":selected")&&x.items.push(l)}},z=function(c){var C,B,A,l,k;for(c=ay(c),A=c.attr("label"),A&&(l=e(c)||{},l[o]=A,l[n]=A,x.optgroups[A]=l),k=ay("option",c),C=0,B=k.length;B>C;C++){d(k[C],A)}};for(x.maxItems=y.attr("multiple")?null:1,h=y.children(),w=0,j=h.length;j>w;w++){i=h[w].tagName.toLowerCase(),"optgroup"===i?z(h[w]):"option"===i&&d(h[w])}};return this.each(function(){if(!this.selectize){var k,j=ay(this),d=this.tagName.toLowerCase(),c=j.attr("placeholder")||j.attr("data-placeholder");c||t.allowEmptyOption||(c=j.children('option[value=""]').text());var b={placeholder:c,options:{},optgroups:{},items:[]};"select"===d?a(j,b):m(j,b),k=new M(j,ay.extend(!0,{},u,b,v))}})},ay.fn.selectize.defaults=M.defaults,M.define("drag_drop",function(){if(!ay.fn.sortable){throw new Error('The "drag_drop" plugin requires jQuery UI "sortable".')}if("multi"===this.settings.mode){var a=this;a.lock=function(){var b=a.lock;return function(){var d=a.$control.data("sortable");return d&&d.disable(),b.apply(a,arguments)}}(),a.unlock=function(){var b=a.unlock;return function(){var d=a.$control.data("sortable");return d&&d.enable(),b.apply(a,arguments)}}(),a.setup=function(){var b=a.setup;return function(){b.apply(this,arguments);var c=a.$control.sortable({items:"[data-value]",forcePlaceholderSize:!0,disabled:a.isLocked,start:function(e,d){d.placeholder.css("width",d.helper.css("width")),c.css({overflow:"visible"})},stop:function(){c.css({overflow:"hidden"});var f=a.$activeItems?a.$activeItems.slice():null,d=[];c.children("[data-value]").each(function(){d.push(ay(this).attr("data-value"))}),a.setValue(d),a.setActiveItem(f)}})}}()}}),M.define("dropdown_header",function(a){var d=this;a=ay.extend({title:"Untitled",headerClass:"selectize-dropdown-header",titleRowClass:"selectize-dropdown-header-title",labelClass:"selectize-dropdown-header-label",closeClass:"selectize-dropdown-header-close",html:function(b){return'<div class="'+b.headerClass+'"><div class="'+b.titleRowClass+'"><span class="'+b.labelClass+'">'+b.title+'</span><a href="javascript:void(0)" class="'+b.closeClass+'">&times;</a></div></div>'}},a),d.setup=function(){var b=d.setup;return function(){b.apply(d,arguments),d.$dropdown_header=ay(a.html(a)),d.$dropdown.prepend(d.$dropdown_header)}}()}),M.define("optgroup_columns",function(a){var h=this;a=ay.extend({equalizeWidth:!0,equalizeHeight:!0},a),this.getAdjacentOption=function(i,l){var k=i.closest("[data-group]").find("[data-selectable]"),j=k.index(i)+l;return j>=0&&j<k.length?k.eq(j):ay()},this.onKeyDown=function(){var b=h.onKeyDown;return function(c){var l,k,j,i;return !this.isOpen||c.keyCode!==ao&&c.keyCode!==al?b.apply(this,arguments):(h.ignoreHover=!0,i=this.$activeOption.closest("[data-group]"),l=i.find("[data-selectable]").index(this.$activeOption),i=c.keyCode===ao?i.prev("[data-group]"):i.next("[data-group]"),j=i.find("[data-selectable]"),k=j.eq(Math.min(j.length-1,l)),void (k.length&&this.setActiveOption(k)))}}();var g=function(){var e,d=g.width,i=document;return"undefined"==typeof d&&(e=i.createElement("div"),e.innerHTML='<div style="width:50px;height:50px;position:absolute;left:-50px;top:-50px;overflow:auto;"><div style="width:1px;height:100px;"></div></div>',e=e.firstChild,i.body.appendChild(e),d=g.width=e.offsetWidth-e.clientWidth,i.body.removeChild(e)),d},f=function(){var o,n,m,l,d,c,b;if(b=ay("[data-group]",h.$dropdown_content),n=b.length,n&&h.$dropdown_content.width()){if(a.equalizeHeight){for(m=0,o=0;n>o;o++){m=Math.max(m,b.eq(o).height())}b.css({height:m})}a.equalizeWidth&&(c=h.$dropdown_content.innerWidth()-g(),l=Math.round(c/n),b.css({width:l}),n>1&&(d=c-l*(n-1),b.eq(n-1).css({width:d})))}};(a.equalizeHeight||a.equalizeWidth)&&(W.after(this,"positionDropdown",f),W.after(this,"refreshOptions",f))}),M.define("remove_button",function(a){if("single"!==this.settings.mode){a=ay.extend({label:"&times;",title:"Remove",className:"remove",append:!0},a);var h=this,g='<a href="javascript:void(0)" class="'+a.className+'" tabindex="-1" title="'+Y(a.title)+'">'+a.label+"</a>",f=function(e,d){var i=e.search(/(<\/[^>]+>\s*)$/);return e.substring(0,i)+d+e.substring(i)};this.setup=function(){var b=h.setup;return function(){if(a.append){var c=h.settings.render.item;h.settings.render.item=function(){return f(c.apply(this,arguments),g)}}b.apply(this,arguments),this.$control.on("click","."+a.className,function(e){if(e.preventDefault(),!h.isLocked){var i=ay(e.currentTarget).parent();h.setActiveItem(i),h.deleteSelection()&&h.setCaret(h.items.length)}})}}()}}),M.define("restore_on_backspace",function(d){var c=this;d.text=d.text||function(b){return b[this.settings.labelField]},this.onKeyDown=function(){var a=c.onKeyDown;return function(f){var h,g;return f.keyCode===ai&&""===this.$control_input.val()&&!this.$activeItems.length&&(h=this.caretPos-1,h>=0&&h<this.items.length)?(g=this.options[this.items[h]],this.deleteSelection(f)&&(this.setTextboxValue(d.text.apply(this,[g])),this.refreshOptions(!0)),void f.preventDefault()):a.apply(this,arguments)}}()}),M});