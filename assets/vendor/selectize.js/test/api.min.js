(function(){describe("API",function(){describe("disable()",function(){var a;before(function(){a=setup_test("<select>",{});a.selectize.disable()});it('should set "disabled" class',function(){expect(a.selectize.$control.hasClass("disabled")).to.be.equal(true)});it("should set isDisabled property to true",function(){expect(a.selectize.isDisabled).to.be.equal(true)});it('should add "disabled" attribute on original input',function(){expect(a.selectize.$input.is(":disabled")).to.be.equal(true)})});describe("enable()",function(){var a;before(function(){a=setup_test("<select disabled>",{});a.selectize.enable()});it('should remove "disabled" class',function(){expect(a.selectize.$control.hasClass("disabled")).to.be.equal(false)});it("should set isDisabled property to false",function(){expect(a.selectize.isDisabled).to.be.equal(false)});it('should remove "disabled" attribute on original input',function(){expect(a.selectize.$input.is(":disabled")).to.be.equal(false)})});describe("focus()",function(){var a;before(function(b){a=setup_test("<select>",{});a.selectize.focus();window.setTimeout(function(){b()},5)});it("should set isFocused property to true",function(){expect(a.selectize.isFocused).to.be.equal(true)});it("should give the control focus",function(){expect(has_focus(a.selectize.$control_input[0])).to.be.equal(true)})});describe("blur()",function(){var a;before(function(b){a=setup_test("<select>",{});a.selectize.focus();window.setTimeout(function(){a.selectize.blur();window.setTimeout(b,5)},5)});it("should set isFocused property to false",function(){expect(a.selectize.isFocused).to.be.equal(false)});it("should remove focus from the control",function(){expect(has_focus(a.selectize.$control_input[0])).to.be.equal(false)})});describe("createItem()",function(){it('should fail if non-object returned by "create" callback',function(){var a=setup_test("<select>",{valueField:"value",labelField:"value",create:function(b){return false}});a.selectize.$control_input.val("test");a.selectize.createItem();expect(a.selectize.items.length).to.be.equal(0);a=setup_test("<select>",{valueField:"value",labelField:"value",create:function(b){return"hello"}});a.selectize.$control_input.val("test");a.selectize.createItem();expect(a.selectize.items.length).to.be.equal(0)});it("should add option upon completion (synchronous)",function(){var a=setup_test("<select>",{valueField:"value",labelField:"value",create:function(b){return{value:b}}});a.selectize.$control_input.val("test");a.selectize.createItem();expect(a.selectize.options).to.have.property("test")});it("should add option upon completion (asynchronous)",function(a){var b=setup_test("<select>",{valueField:"value",labelField:"value",create:function(c,d){window.setTimeout(function(){d({value:c});expect(b.selectize.options).to.have.property("test");a()},0)}});b.selectize.$control_input.val("test");b.selectize.createItem()})});describe("addOptionGroup()",function(){var a;before(function(){a=setup_test("<select>",{valueField:"value",labelField:"value"})});it("should register group",function(){var b={label:"Group Label"};a.selectize.addOptionGroup("group_id",b);expect(a.selectize.optgroups).to.have.property("group_id");expect(a.selectize.optgroups.group_id).to.eql(b)})});describe("addOption()",function(){var a;before(function(){a=setup_test("<select>",{valueField:"value",labelField:"value"})});it("should allow string values",function(){a.selectize.addOption({value:"stringtest"});expect(a.selectize.options).to.have.property("stringtest")});it("should not allow null / undefined values",function(){a.selectize.addOption({value:undefined});a.selectize.addOption({value:null});expect(a.selectize.options).to.not.have.property("undefined");expect(a.selectize.options).to.not.have.property("null");expect(a.selectize.options).to.not.have.property("")});it("should allow integer values",function(){a.selectize.addOption({value:0});a.selectize.addOption({value:1});expect(a.selectize.options).to.have.property("0");expect(a.selectize.options).to.have.property("1")});it("should allow arrays of options",function(){a.selectize.addOption([{value:"a"},{value:"b"}]);expect(a.selectize.options).to.have.property("a");expect(a.selectize.options).to.have.property("b")});it("should not override existing options",function(){a.selectize.addOption([{value:"a"},{value:"b"}]);a.selectize.addOption({value:"a",test:"hello"});expect(a.selectize.options.a).to.not.have.property("test")})});describe("addItem()",function(){var a;before(function(){a=setup_test("<select multiple>",{valueField:"value",labelField:"value",options:[{value:0},{value:1},{value:"undefined"},{value:"null"},{value:"a"},{value:"b"},{value:"c"},{value:"$1"},{value:"'"},{value:'"'},{value:"\\'"},{value:'\\"'},]})});it('should update "items" array',function(){a.selectize.addItem("b");expect(a.selectize.items.indexOf("b")).to.be.equal(0)});it("should not give control focus",function(b){a.selectize.addItem(0);window.setTimeout(function(){expect(a.selectize.isFocused).to.be.equal(false);b()},0)});it("should not allow duplicate entries",function(){a.selectize.addItem("a");a.selectize.addItem("a");expect(a.selectize.items.indexOf("a")).to.be.equal(a.selectize.items.lastIndexOf("a"))});it("should not allow undefined / null values",function(){a.selectize.addItem(undefined);a.selectize.addItem(null);expect(a.selectize.items.indexOf("undefined")).to.be.equal(-1);expect(a.selectize.items.indexOf("null")).to.be.equal(-1)});it("should allow integer values",function(){a.selectize.addItem(0);expect(a.selectize.items.indexOf("0")).to.not.be.equal(-1)});it("should update DOM",function(){a.selectize.addItem("c");expect(a.selectize.$control.find("[data-value=c]").length).to.be.equal(1);a.selectize.addItem("$1");var b=false;a.selectize.$control.children().each(function(){if(this.getAttribute("data-value")==="$1"){b=true;return false}});expect(b).to.be.equal(true)})});describe("updateOption()",function(){var a;before(function(){a=setup_test("<select multiple>",{valueField:"value",labelField:"value",options:[{value:0},{value:1},{value:"a"},{value:"b"},{value:"c"},{value:"d"},{value:"e"},{value:"f"},{value:"null"},{value:"undefined"},{value:"'"},{value:'"'},{value:"\\'"},{value:'\\"'},],items:["e","f"]})});it("should update option data",function(){a.selectize.updateOption("a",{value:"a",test:"test"});expect(a.selectize.options).to.have.property("a");expect(a.selectize.options.a.test).to.equal("test")});it("should update indexes",function(){a.selectize.updateOption("e",{value:"e_updated"});expect(a.selectize.options).to.not.have.property("e");expect(a.selectize.options).to.have.property("e_updated");expect(a.selectize.items.indexOf("e")).to.be.equal(-1);expect(a.selectize.items.indexOf("e_updated")).to.be.equal(0)});it("should allow integer values",function(){a.selectize.updateOption(0,{value:"0_updated"});a.selectize.updateOption(1,{value:"1_updated"});expect(a.selectize.options).to.not.have.property("0");expect(a.selectize.options).to.not.have.property("1");expect(a.selectize.options).to.have.property("0_updated");expect(a.selectize.options).to.have.property("1_updated")});it("should throw error if value not set in data",function(){expect(function(){a.selectize.updateOption("c",{value:undefined,test:"test"});a.selectize.updateOption("d",{value:null,test:"test"})}).to.throw(Error)});it("should ignore undefined / null value references",function(){a.selectize.updateOption(undefined,{value:"undefined",test:"test"});a.selectize.updateOption(null,{value:"null",test:"test"});expect(a.selectize.options["undefined"]).to.not.have.property("test");expect(a.selectize.options["null"]).to.not.have.property("test")});it("should update DOM",function(){a.selectize.updateOption("f",{value:"f_updated"});expect(a.selectize.$control.find("[data-value=f]").length).to.be.equal(0);expect(a.selectize.$control.find("[data-value=f_updated]").length).to.be.equal(1)})});describe("getOption()",function(){var a;before(function(){a=setup_test("<select>",{valueField:"value",labelField:"value",options:[{value:0},{value:1},{value:"a"},{value:"b"},{value:"'"},{value:"\\"},{value:'"'},{value:"\\'"},{value:'\\"'},]});a.selectize.refreshOptions(true)});it("should allow string values",function(){expect(a.selectize.getOption("a")).to.be.ok;expect(a.selectize.getOption("a").length).to.be.equal(1);expect(a.selectize.getOption("b")).to.be.ok;expect(a.selectize.getOption("b").length).to.be.equal(1)});it("should allow integer values",function(){expect(a.selectize.getOption(0)).to.be.ok;expect(a.selectize.getOption(0).length).to.be.equal(1);expect(a.selectize.getOption(1)).to.be.ok;expect(a.selectize.getOption(1).length).to.be.equal(1)});it("should allow values with quotation marks",function(){expect(a.selectize.getOption("'")).to.be.ok;expect(a.selectize.getOption("'").length).to.be.equal(1);expect(a.selectize.getOption('"')).to.be.ok;expect(a.selectize.getOption('"').length).to.be.equal(1)});it("should allow values with backslashes",function(){expect(a.selectize.getOption("\\")).to.be.ok;expect(a.selectize.getOption("\\").length).to.be.equal(1);expect(a.selectize.getOption("\\'")).to.be.ok;expect(a.selectize.getOption("\\'").length).to.be.equal(1);expect(a.selectize.getOption('\\"')).to.be.ok;expect(a.selectize.getOption('\\"').length).to.be.equal(1)});it("should not allow undefined / null values",function(){expect(a.selectize.getOption(null)).to.be.ok;expect(a.selectize.getOption(null).length).to.be.equal(0);expect(a.selectize.getOption(undefined)).to.be.ok;expect(a.selectize.getOption(undefined).length).to.be.equal(0)})});describe("getItem()",function(){var a;before(function(){a=setup_test("<select multiple>",{valueField:"value",labelField:"value",options:[{value:0},{value:1},{value:"a"},{value:"b"},{value:"'"},{value:'"'},{value:"\\'"},{value:'\\"'}],items:["0","1","a","b","'",'"',"\\'",'\\"']})});it("should allow string values",function(){expect(a.selectize.getItem("a")).to.be.ok;expect(a.selectize.getItem("a").length).to.be.equal(1);expect(a.selectize.getItem("b")).to.be.ok;expect(a.selectize.getItem("b").length).to.be.equal(1)});it("should allow integer values",function(){expect(a.selectize.getItem(0)).to.be.ok;expect(a.selectize.getItem(0).length).to.be.equal(1);expect(a.selectize.getItem(1)).to.be.ok;expect(a.selectize.getItem(1).length).to.be.equal(1)});it("should allow values with quotation marks",function(){expect(a.selectize.getItem("'")).to.be.ok;expect(a.selectize.getItem("'").length).to.be.equal(1);expect(a.selectize.getItem('"')).to.be.ok;expect(a.selectize.getItem('"').length).to.be.equal(1)});it("should allow values with backslashes",function(){expect(a.selectize.getItem("\\'")).to.be.ok;expect(a.selectize.getItem("\\'").length).to.be.equal(1);expect(a.selectize.getItem('\\"')).to.be.ok;expect(a.selectize.getItem('\\"').length).to.be.equal(1)});it("should not allow undefined / null values",function(){expect(a.selectize.getItem(null)).to.be.ok;expect(a.selectize.getItem(null).length).to.be.equal(0);expect(a.selectize.getItem(undefined)).to.be.ok;expect(a.selectize.getItem(undefined).length).to.be.equal(0)})});describe("clear()",function(){var a;beforeEach(function(){a=setup_test("<select multiple>",{valueField:"value",labelField:"value",options:[{value:0},{value:1},{value:2},{value:3},],items:["1","2","3"]})});it('should empty "$activeItems" array',function(){a.selectize.setActiveItem(a.selectize.getItem("1"));expect(a.selectize.$activeItems.length).to.be.equal(1);a.selectize.clear();expect(a.selectize.$activeItems.length).to.be.equal(0)});it("should refresh option list (dropdown)",function(b){a.selectize.focus();window.setTimeout(function(){a.selectize.clear();a.selectize.focus();window.setTimeout(function(){expect(a.selectize.$dropdown_content.find("[data-value=1]").length).to.be.equal(1);expect(a.selectize.$dropdown_content.find("[data-value=2]").length).to.be.equal(1);expect(a.selectize.$dropdown_content.find("[data-value=3]").length).to.be.equal(1);b()},0)},0)});it('should empty "items" array',function(){a.selectize.clear();expect(a.selectize.items.length).to.be.equal(0)});it("should update DOM",function(){a.selectize.clear();expect(a.selectize.$control.find("[data-value=1]").length).to.be.equal(0);expect(a.selectize.$control.find("[data-value=2]").length).to.be.equal(0);expect(a.selectize.$control.find("[data-value=3]").length).to.be.equal(0)});it("should not give control focus",function(b){a.selectize.clear();window.setTimeout(function(){expect(a.selectize.isFocused).to.be.equal(false);b()},0)});it('should empty "items" array',function(){a.selectize.clear();expect(a.selectize.items.length).to.be.equal(0)})});describe("search()",function(){it('should throw error if "score" setting does not return a function',function(){var a;expect(function(){a=setup_test("<select multiple>",{valueField:"value",labelField:"value",options:[{value:0},{value:1}],score:function(){}});a.selectize.search("hello")}).to.throw(Error)});it('should not throw error if "score" setting does return a function',function(){var a;expect(function(){a=setup_test("<select multiple>",{valueField:"value",labelField:"value",options:[{value:0},{value:1}],score:function(b){return function(c){return 0}}});a.selectize.search("hello")}).to.not.throw(Error)})});describe("getScoreFunction()",function(){it("should return an function that returns a number",function(){var b=setup_test("<select multiple>",{valueField:"value",labelField:"value",searchField:"value",options:[]});var a=b.selectize.getScoreFunction("test");expect(typeof a).to.be.equal("function");expect(typeof a({value:"test"})).to.be.equal("number");expect(a({value:"test"})).to.be.above(0)})});describe("destroy()",function(){var a=function(d,e){var c,g,b;var f=($._data||$.data).apply($,[$(window)[0],"events"]);e=e.replace(/^./,"");for(b in f){if(f.hasOwnProperty(b)){for(c=0,g=f[b].length;c<g;c++){if(f[b][c].namespace.indexOf(e)!==-1){return true}}}}return false};it("should remove control from DOM",function(){var b=setup_test("<select>",{});b.selectize.destroy();expect($.contains(document.documentElement,b.selectize.$wrapper[0])).to.be.equal(false)});it('should delete "selectize" reference on original input element',function(){var b=setup_test("<select>",{});b.selectize.destroy();expect(b.selectize.$input[0].selectize).to.be.equal(undefined)});it("should unbind events on window",function(){var b=setup_test("<select>",{});b.selectize.destroy();expect(a($(window),b.selectize.eventNS)).to.be.equal(false)});it("should unbind events on document",function(){var b=setup_test("<select>",{});b.selectize.destroy();expect(a($(document),b.selectize.eventNS)).to.be.equal(false)});it("should unbind events on <body>",function(){var b=setup_test("<select>",{});b.selectize.destroy();expect(a($("body"),b.selectize.eventNS)).to.be.equal(false)});it("should restore original options and tabindex",function(){var b='<optgroup label="Swedish Cars"><option value="volvo">Volvo</option><option value="saab">Saab</option></optgroup><optgroup label="German Cars"><option value="mercedes">Mercedes</option><option value="audi">Audi</option></optgroup>';var c=setup_test('<select tabindex="9999">'+b+"</select>",{});c.selectize.destroy();expect(c.$select.html()).to.be.equal(b);expect(c.$select.attr("tabindex")).to.be.equal("9999")});it("should remove tabindex if it was originally undefined",function(){var b=setup_test("<select>",{});b.selectize.destroy();expect(b.$select.attr("tabindex")).to.be.equal(undefined)})});describe("clearCache()",function(){var a;before(function(){a=setup_test("<select multiple>",{valueField:"value",labelField:"value",options:[{value:0},{value:1},{value:2},{value:3},],items:["1","2","3"]});a.selectize.advanceSelection(1);a.selectize.refreshOptions(true);a.selectize.refreshItems()});it("should clear the whole renderCache",function(){expect($.isEmptyObject(a.selectize.renderCache)).to.be.equal(false);a.selectize.clearCache();expect($.isEmptyObject(a.selectize.renderCache)).to.be.equal(true)});it("should allow clearing just one template type from the renderCache",function(){a.selectize.render("item",a.selectize.options[0]);a.selectize.refreshOptions();expect($.isEmptyObject(a.selectize.renderCache.option)).to.be.equal(false);expect($.isEmptyObject(a.selectize.renderCache.item)).to.be.equal(false);a.selectize.clearCache("option");expect($.isEmptyObject(a.selectize.renderCache.option)).to.be.equal(true);expect($.isEmptyObject(a.selectize.renderCache.item)).to.be.equal(false)})})})})();