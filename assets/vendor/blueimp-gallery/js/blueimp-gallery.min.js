(function(a){if(typeof define==="function"&&define.amd){define(["./blueimp-helper"],a)}else{window.blueimp=window.blueimp||{};window.blueimp.Gallery=a(window.blueimp.helper||window.jQuery)}}(function(a){function b(d,c){if(document.body.style.maxHeight===undefined){return null}if(!this||this.options!==b.prototype.options){return new b(d,c)}if(!d||!d.length){this.console.log("blueimp Gallery: No or empty list provided as first argument.",d);return}this.list=d;this.num=d.length;this.initOptions(c);this.initialize()}a.extend(b.prototype,{options:{container:"#blueimp-gallery",slidesContainer:"div",titleElement:"h3",displayClass:"blueimp-gallery-display",controlsClass:"blueimp-gallery-controls",singleClass:"blueimp-gallery-single",leftEdgeClass:"blueimp-gallery-left",rightEdgeClass:"blueimp-gallery-right",playingClass:"blueimp-gallery-playing",slideClass:"slide",slideLoadingClass:"slide-loading",slideErrorClass:"slide-error",slideContentClass:"slide-content",toggleClass:"toggle",prevClass:"prev",nextClass:"next",closeClass:"close",playPauseClass:"play-pause",typeProperty:"type",titleProperty:"title",urlProperty:"href",displayTransition:true,clearSlides:true,stretchImages:false,toggleControlsOnReturn:true,toggleSlideshowOnSpace:true,enableKeyboardNavigation:true,closeOnEscape:true,closeOnSlideClick:true,closeOnSwipeUpOrDown:true,emulateTouchEvents:true,stopTouchEventsPropagation:false,hidePageScrollbars:true,disableScroll:true,carousel:false,continuous:true,unloadElements:true,startSlideshow:false,slideshowInterval:5000,index:0,preloadRange:2,transitionSpeed:400,slideshowTransitionSpeed:undefined,event:undefined,onopen:undefined,onopened:undefined,onslide:undefined,onslideend:undefined,onslidecomplete:undefined,onclose:undefined,onclosed:undefined},carouselOptions:{hidePageScrollbars:false,toggleControlsOnReturn:false,toggleSlideshowOnSpace:false,enableKeyboardNavigation:false,closeOnEscape:false,closeOnSlideClick:false,closeOnSwipeUpOrDown:false,disableScroll:false,startSlideshow:true},console:window.console&&typeof window.console.log==="function"?window.console:{log:function(){}},support:(function(c){var d={touch:window.ontouchstart!==undefined||(window.DocumentTouch&&document instanceof DocumentTouch)},f={webkitTransition:{end:"webkitTransitionEnd",prefix:"-webkit-"},MozTransition:{end:"transitionend",prefix:"-moz-"},OTransition:{end:"otransitionend",prefix:"-o-"},transition:{end:"transitionend",prefix:""}},e=function(){var h=d.transition,i,g;document.body.appendChild(c);if(h){i=h.name.slice(0,-9)+"ransform";if(c.style[i]!==undefined){c.style[i]="translateZ(0)";g=window.getComputedStyle(c).getPropertyValue(h.prefix+"transform");d.transform={prefix:h.prefix,name:i,translate:true,translateZ:!!g&&g!=="none"}}}if(c.style.backgroundSize!==undefined){d.backgroundSize={};c.style.backgroundSize="contain";d.backgroundSize.contain=window.getComputedStyle(c).getPropertyValue("background-size")==="contain";c.style.backgroundSize="cover";d.backgroundSize.cover=window.getComputedStyle(c).getPropertyValue("background-size")==="cover"}document.body.removeChild(c)};(function(g,h){var i;for(i in h){if(h.hasOwnProperty(i)&&c.style[i]!==undefined){g.transition=h[i];g.transition.name=i;break}}}(d,f));if(document.body){e()}else{a(document).on("DOMContentLoaded",e)}return d}(document.createElement("div"))),requestAnimationFrame:window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame,initialize:function(){this.initStartIndex();if(this.initWidget()===false){return false}this.initEventListeners();this.onslide(this.index);this.ontransitionend();if(this.options.startSlideshow){this.play()}},slide:function(h,d){window.clearTimeout(this.timeout);var c=this.index,f,g,e;if(c===h||this.num===1){return}if(!d){d=this.options.transitionSpeed}if(this.support.transform){if(!this.options.continuous){h=this.circle(h)}f=Math.abs(c-h)/(c-h);if(this.options.continuous){g=f;f=-this.positions[this.circle(h)]/this.slideWidth;if(f!==g){h=-f*this.num+h}}e=Math.abs(c-h)-1;while(e){e-=1;this.move(this.circle((h>c?h:c)-e-1),this.slideWidth*f,0)}h=this.circle(h);this.move(c,this.slideWidth*f,d);this.move(h,0,d);if(this.options.continuous){this.move(this.circle(h-f),-(this.slideWidth*f),0)}}else{h=this.circle(h);this.animate(c*-this.slideWidth,h*-this.slideWidth,d)}this.onslide(h)},getIndex:function(){return this.index},getNumber:function(){return this.num},prev:function(){if(this.options.continuous||this.index){this.slide(this.index-1)}},next:function(){if(this.options.continuous||this.index<this.num-1){this.slide(this.index+1)}},play:function(d){var c=this;window.clearTimeout(this.timeout);this.interval=d||this.options.slideshowInterval;if(this.elements[this.index]>1){this.timeout=this.setTimeout((!this.requestAnimationFrame&&this.slide)||function(f,e){c.animationFrameId=c.requestAnimationFrame.call(window,function(){c.slide(f,e)})},[this.index+1,this.options.slideshowTransitionSpeed],this.interval)}this.container.addClass(this.options.playingClass)},pause:function(){window.clearTimeout(this.timeout);this.interval=null;this.container.removeClass(this.options.playingClass)},add:function(d){var c;if(!d.concat){d=Array.prototype.slice.call(d)}if(!this.list.concat){this.list=Array.prototype.slice.call(this.list)}this.list=this.list.concat(d);this.num=this.list.length;if(this.num>2&&this.options.continuous===null){this.options.continuous=true;this.container.removeClass(this.options.leftEdgeClass)}this.container.removeClass(this.options.rightEdgeClass).removeClass(this.options.singleClass);for(c=this.num-d.length;c<this.num;c+=1){this.addSlide(c);this.positionSlide(c)}this.positions.length=this.num;this.initSlides(true)},resetSlides:function(){this.slidesContainer.empty();this.unloadAllSlides();this.slides=[]},handleClose:function(){var c=this.options;this.destroyEventListeners();this.pause();this.container[0].style.display="none";this.container.removeClass(c.displayClass).removeClass(c.singleClass).removeClass(c.leftEdgeClass).removeClass(c.rightEdgeClass);if(c.hidePageScrollbars){document.body.style.overflow=this.bodyOverflowStyle}if(this.options.clearSlides){this.resetSlides()}if(this.options.onclosed){this.options.onclosed.call(this)}},close:function(){var d=this,c=function(e){if(e.target===d.container[0]){d.container.off(d.support.transition.end,c);d.handleClose()}};if(this.options.onclose){this.options.onclose.call(this)}if(this.support.transition&&this.options.displayTransition){this.container.on(this.support.transition.end,c);this.container.removeClass(this.options.displayClass)}else{this.handleClose()}},circle:function(c){return(this.num+(c%this.num))%this.num},move:function(c,e,d){this.translateX(c,e,d);this.positions[c]=e},translate:function(e,c,i,g){var f=this.slides[e].style,h=this.support.transition,d=this.support.transform;f[h.name+"Duration"]=g+"ms";f[d.name]="translate("+c+"px, "+i+"px)"+(d.translateZ?" translateZ(0)":"")},translateX:function(d,c,e){this.translate(d,c,0,e)},translateY:function(c,e,d){this.translate(c,0,e,d)},animate:function(h,g,d){if(!d){this.slidesContainer[0].style.left=g+"px";return}var c=this,f=new Date().getTime(),e=window.setInterval(function(){var i=new Date().getTime()-f;if(i>d){c.slidesContainer[0].style.left=g+"px";c.ontransitionend();window.clearInterval(e);return}c.slidesContainer[0].style.left=(((g-h)*(Math.floor((i/d)*100)/100))+h)+"px"},4)},preventDefault:function(c){if(c.preventDefault){c.preventDefault()}else{c.returnValue=false}},stopPropagation:function(c){if(c.stopPropagation){c.stopPropagation()}else{c.cancelBubble=true}},onresize:function(){this.initSlides(true)},onmousedown:function(c){if(c.which&&c.which===1&&c.target.nodeName!=="VIDEO"){c.preventDefault();(c.originalEvent||c).touches=[{pageX:c.pageX,pageY:c.pageY}];this.ontouchstart(c)}},onmousemove:function(c){if(this.touchStart){(c.originalEvent||c).touches=[{pageX:c.pageX,pageY:c.pageY}];this.ontouchmove(c)}},onmouseup:function(c){if(this.touchStart){this.ontouchend(c);delete this.touchStart}},onmouseout:function(c){if(this.touchStart){var e=c.target,d=c.relatedTarget;if(!d||(d!==e&&!a.contains(e,d))){this.onmouseup(c)}}},ontouchstart:function(c){if(this.options.stopTouchEventsPropagation){this.stopPropagation(c)}var d=(c.originalEvent||c).touches[0];this.touchStart={x:d.pageX,y:d.pageY,time:Date.now()};this.isScrolling=undefined;this.touchDelta={}},ontouchmove:function(e){if(this.options.stopTouchEventsPropagation){this.stopPropagation(e)}var f=(e.originalEvent||e).touches[0],h=(e.originalEvent||e).scale,d=this.index,c,g;if(f.length>1||(h&&h!==1)){return}if(this.options.disableScroll){e.preventDefault()}this.touchDelta={x:f.pageX-this.touchStart.x,y:f.pageY-this.touchStart.y};c=this.touchDelta.x;if(this.isScrolling===undefined){this.isScrolling=this.isScrolling||Math.abs(c)<Math.abs(this.touchDelta.y)}if(!this.isScrolling){e.preventDefault();window.clearTimeout(this.timeout);if(this.options.continuous){g=[this.circle(d+1),d,this.circle(d-1)]}else{this.touchDelta.x=c=c/(((!d&&c>0)||(d===this.num-1&&c<0))?(Math.abs(c)/this.slideWidth+1):1);g=[d];if(d){g.push(d-1)}if(d<this.num-1){g.unshift(d+1)}}while(g.length){d=g.pop();this.translateX(d,c+this.positions[d],0)}}else{if(this.options.closeOnSwipeUpOrDown){this.translateY(d,this.touchDelta.y+this.positions[d],0)}}},ontouchend:function(c){if(this.options.stopTouchEventsPropagation){this.stopPropagation(c)}var j=this.index,g=this.options.transitionSpeed,f=this.slideWidth,d=Number(Date.now()-this.touchStart.time)<250,i=(d&&Math.abs(this.touchDelta.x)>20)||Math.abs(this.touchDelta.x)>f/2,e=(!j&&this.touchDelta.x>0)||(j===this.num-1&&this.touchDelta.x<0),o=!i&&this.options.closeOnSwipeUpOrDown&&((d&&Math.abs(this.touchDelta.y)>20)||Math.abs(this.touchDelta.y)>this.slideHeight/2),l,h,n,k,m;if(this.options.continuous){e=false}l=this.touchDelta.x<0?-1:1;if(!this.isScrolling){if(i&&!e){h=j+l;n=j-l;k=f*l;m=-f*l;if(this.options.continuous){this.move(this.circle(h),k,0);this.move(this.circle(j-2*l),m,0)}else{if(h>=0&&h<this.num){this.move(h,k,0)}}this.move(j,this.positions[j]+k,g);this.move(this.circle(n),this.positions[this.circle(n)]+k,g);j=this.circle(n);this.onslide(j)}else{if(this.options.continuous){this.move(this.circle(j-1),-f,g);this.move(j,0,g);this.move(this.circle(j+1),f,g)}else{if(j){this.move(j-1,-f,g)}this.move(j,0,g);if(j<this.num-1){this.move(j+1,f,g)}}}}else{if(o){this.close()}else{this.translateY(j,0,g)}}},ontouchcancel:function(c){if(this.touchStart){this.ontouchend(c);delete this.touchStart}},ontransitionend:function(d){var c=this.slides[this.index];if(!d||c===d.target){if(this.interval){this.play()}this.setTimeout(this.options.onslideend,[this.index,c])}},oncomplete:function(e){var f=e.target||e.srcElement,d=f&&f.parentNode,c;if(!f||!d){return}c=this.getNodeIndex(d);a(d).removeClass(this.options.slideLoadingClass);if(e.type==="error"){a(d).addClass(this.options.slideErrorClass);this.elements[c]=3}else{this.elements[c]=2}if(f.clientHeight>this.container[0].clientHeight){f.style.maxHeight=this.container[0].clientHeight}if(this.interval&&this.slides[this.index]===d){this.play()}this.setTimeout(this.options.onslidecomplete,[c,d])},onload:function(c){this.oncomplete(c)},onerror:function(c){this.oncomplete(c)},onkeydown:function(c){switch(c.which||c.keyCode){case 13:if(this.options.toggleControlsOnReturn){this.preventDefault(c);this.toggleControls()}break;case 27:if(this.options.closeOnEscape){this.close();c.stopImmediatePropagation()}break;case 32:if(this.options.toggleSlideshowOnSpace){this.preventDefault(c);this.toggleSlideshow()}break;case 37:if(this.options.enableKeyboardNavigation){this.preventDefault(c);this.prev()}break;case 39:if(this.options.enableKeyboardNavigation){this.preventDefault(c);this.next()}break}},handleClick:function(f){var c=this.options,g=f.target||f.srcElement,e=g.parentNode,d=function(h){return a(g).hasClass(h)||a(e).hasClass(h)};if(d(c.toggleClass)){this.preventDefault(f);this.toggleControls()}else{if(d(c.prevClass)){this.preventDefault(f);this.prev()}else{if(d(c.nextClass)){this.preventDefault(f);this.next()}else{if(d(c.closeClass)){this.preventDefault(f);this.close()}else{if(d(c.playPauseClass)){this.preventDefault(f);this.toggleSlideshow()}else{if(e===this.slidesContainer[0]){this.preventDefault(f);if(c.closeOnSlideClick){this.close()}else{this.toggleControls()}}else{if(e.parentNode&&e.parentNode===this.slidesContainer[0]){this.preventDefault(f);this.toggleControls()}}}}}}}},onclick:function(c){if(this.options.emulateTouchEvents&&this.touchDelta&&(Math.abs(this.touchDelta.x)>20||Math.abs(this.touchDelta.y)>20)){delete this.touchDelta;return}return this.handleClick(c)},updateEdgeClasses:function(c){if(!c){this.container.addClass(this.options.leftEdgeClass)}else{this.container.removeClass(this.options.leftEdgeClass)}if(c===this.num-1){this.container.addClass(this.options.rightEdgeClass)}else{this.container.removeClass(this.options.rightEdgeClass)}},handleSlide:function(c){if(!this.options.continuous){this.updateEdgeClasses(c)}this.loadElements(c);if(this.options.unloadElements){this.unloadElements(c)}this.setTitle(c)},onslide:function(c){this.index=c;this.handleSlide(c);this.setTimeout(this.options.onslide,[c,this.slides[c]])},setTitle:function(c){var e=this.slides[c].firstChild.title,d=this.titleElement;if(d.length){this.titleElement.empty();if(e){d[0].appendChild(document.createTextNode(e))}}},setTimeout:function(e,c,f){var d=this;return e&&window.setTimeout(function(){e.apply(d,c||[])},f||0)},imageFactory:function(e,l){var h=this,g=this.imagePrototype.cloneNode(false),c=e,k=this.options.stretchImages,j,f,d=function(m){if(!j){m={type:m.type,target:f};if(!f.parentNode){return h.setTimeout(d,[m])}j=true;a(g).off("load error",d);if(k){if(m.type==="load"){f.style.background='url("'+c+'") center no-repeat';f.style.backgroundSize=k}}l(m)}},i;if(typeof c!=="string"){c=this.getItemProperty(e,this.options.urlProperty);i=this.getItemProperty(e,this.options.titleProperty)}if(k===true){k="contain"}k=this.support.backgroundSize&&this.support.backgroundSize[k]&&k;if(k){f=this.elementPrototype.cloneNode(false)}else{f=g;g.draggable=false}if(i){f.title=i}a(g).on("load error",d);g.src=c;return f},createElement:function(f,g){var e=f&&this.getItemProperty(f,this.options.typeProperty),c=(e&&this[e.split("/")[0]+"Factory"])||this.imageFactory,d=f&&c.call(this,f,g);if(!d){d=this.elementPrototype.cloneNode(false);this.setTimeout(g,[{type:"error",target:d}])}a(d).addClass(this.options.slideContentClass);return d},loadElement:function(c){if(!this.elements[c]){if(this.slides[c].firstChild){this.elements[c]=a(this.slides[c]).hasClass(this.options.slideErrorClass)?3:2}else{this.elements[c]=1;a(this.slides[c]).addClass(this.options.slideLoadingClass);this.slides[c].appendChild(this.createElement(this.list[c],this.proxyListener))}}},loadElements:function(e){var c=Math.min(this.num,this.options.preloadRange*2+1),d=e,f;for(f=0;f<c;f+=1){d+=f*(f%2===0?-1:1);d=this.circle(d);this.loadElement(d)}},unloadElements:function(c){var d,e;for(d in this.elements){if(this.elements.hasOwnProperty(d)){e=Math.abs(c-d);if(e>this.options.preloadRange&&e+this.options.preloadRange<this.num){this.unloadSlide(d);delete this.elements[d]}}}},addSlide:function(d){var c=this.slidePrototype.cloneNode(false);c.setAttribute("data-index",d);this.slidesContainer[0].appendChild(c);this.slides.push(c)},positionSlide:function(d){var c=this.slides[d];c.style.width=this.slideWidth+"px";if(this.support.transform){c.style.left=(d*-this.slideWidth)+"px";this.move(d,this.index>d?-this.slideWidth:(this.index<d?this.slideWidth:0),0)}},initSlides:function(e){var c,d;if(!e){this.positions=[];this.positions.length=this.num;this.elements={};this.imagePrototype=document.createElement("img");this.elementPrototype=document.createElement("div");this.slidePrototype=document.createElement("div");a(this.slidePrototype).addClass(this.options.slideClass);this.slides=this.slidesContainer[0].children;c=this.options.clearSlides||this.slides.length!==this.num}this.slideWidth=this.container[0].offsetWidth;this.slideHeight=this.container[0].offsetHeight;this.slidesContainer[0].style.width=(this.num*this.slideWidth)+"px";if(c){this.resetSlides()}for(d=0;d<this.num;d+=1){if(c){this.addSlide(d)}this.positionSlide(d)}if(this.options.continuous&&this.support.transform){this.move(this.circle(this.index-1),-this.slideWidth,0);this.move(this.circle(this.index+1),this.slideWidth,0)}if(!this.support.transform){this.slidesContainer[0].style.left=(this.index*-this.slideWidth)+"px"}},unloadSlide:function(d){var c,e;c=this.slides[d];e=c.firstChild;if(e!==null){c.removeChild(e)}},unloadAllSlides:function(){var d,c;for(d=0,c=this.slides.length;d<c;d++){this.unloadSlide(d)}},toggleControls:function(){var c=this.options.controlsClass;if(this.container.hasClass(c)){this.container.removeClass(c)}else{this.container.addClass(c)}},toggleSlideshow:function(){if(!this.interval){this.play()}else{this.pause()}},getNodeIndex:function(c){return parseInt(c.getAttribute("data-index"),10)},getNestedProperty:function(d,c){c.replace(/\[(?:'([^']+)'|"([^"]+)"|(\d+))\]|(?:(?:^|\.)([^\.\[]+))/g,function(i,g,h,e,f){var j=f||g||h||(e&&parseInt(e,10));if(i&&d){d=d[j]}});return d},getDataProperty:function(d,c){if(d.getAttribute){var f=d.getAttribute("data-"+c.replace(/([A-Z])/g,"-$1").toLowerCase());if(typeof f==="string"){if(/^(true|false|null|-?\d+(\.\d+)?|\{[\s\S]*\}|\[[\s\S]*\])$/.test(f)){try{return a.parseJSON(f)}catch(e){}}return f}}},getItemProperty:function(d,c){var e=d[c];if(e===undefined){e=this.getDataProperty(d,c);if(e===undefined){e=this.getNestedProperty(d,c)}}return e},initStartIndex:function(){var c=this.options.index,e=this.options.urlProperty,d;if(c&&typeof c!=="number"){for(d=0;d<this.num;d+=1){if(this.list[d]===c||this.getItemProperty(this.list[d],e)===this.getItemProperty(c,e)){c=d;break}}}this.index=this.circle(parseInt(c,10)||0)},initEventListeners:function(){var c=this,d=this.slidesContainer,e=function(g){var f=c.support.transition&&c.support.transition.end===g.type?"transitionend":g.type;c["on"+f](g)};a(window).on("resize",e);a(document.body).on("keydown",e);this.container.on("click",e);if(this.support.touch){d.on("touchstart touchmove touchend touchcancel",e)}else{if(this.options.emulateTouchEvents&&this.support.transition){d.on("mousedown mousemove mouseup mouseout",e)}}if(this.support.transition){d.on(this.support.transition.end,e)}this.proxyListener=e},destroyEventListeners:function(){var c=this.slidesContainer,d=this.proxyListener;a(window).off("resize",d);a(document.body).off("keydown",d);this.container.off("click",d);if(this.support.touch){c.off("touchstart touchmove touchend touchcancel",d)}else{if(this.options.emulateTouchEvents&&this.support.transition){c.off("mousedown mousemove mouseup mouseout",d)}}if(this.support.transition){c.off(this.support.transition.end,d)}},handleOpen:function(){if(this.options.onopened){this.options.onopened.call(this)}},initWidget:function(){var d=this,c=function(e){if(e.target===d.container[0]){d.container.off(d.support.transition.end,c);d.handleOpen()}};this.container=a(this.options.container);if(!this.container.length){this.console.log("blueimp Gallery: Widget container not found.",this.options.container);return false}this.slidesContainer=this.container.find(this.options.slidesContainer).first();if(!this.slidesContainer.length){this.console.log("blueimp Gallery: Slides container not found.",this.options.slidesContainer);return false}this.titleElement=this.container.find(this.options.titleElement).first();if(this.num===1){this.container.addClass(this.options.singleClass)}if(this.options.onopen){this.options.onopen.call(this)}if(this.support.transition&&this.options.displayTransition){this.container.on(this.support.transition.end,c)}else{this.handleOpen()}if(this.options.hidePageScrollbars){this.bodyOverflowStyle=document.body.style.overflow;document.body.style.overflow="hidden"}this.container[0].style.display="block";this.initSlides();this.container.addClass(this.options.displayClass)},initOptions:function(c){this.options=a.extend({},this.options);if((c&&c.carousel)||(this.options.carousel&&(!c||c.carousel!==false))){a.extend(this.options,this.carouselOptions)}a.extend(this.options,c);if(this.num<3){this.options.continuous=this.options.continuous?null:false}if(!this.support.transition){this.options.emulateTouchEvents=false}if(this.options.event){this.preventDefault(this.options.event)}}});return b}));